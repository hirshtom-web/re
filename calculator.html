<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Home</title>

  <!-- Google Fonts + Material Symbols -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Inline CSS (optional) -->
  <style>
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: #f0f0f0;
      min-height: 100vh;
    }


/* ===================== */
/* Base Styles */
/* ===================== */

body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background: #f3f5f7;
    margin: 0;
    padding: 0; /* remove 40px from body */
    color: #1e0949;
}

.main-content {
    padding: 40px; /* your previous body padding goes here */
}


.info {
    font-size: 10px;
    color: #555;
    cursor: help;
    margin-left: 4px;
}

.container {
    display: flex;
    gap: 40px;
    max-width: 1400px;
    margin: 0 auto;
    flex-wrap: wrap;
    align-items: stretch; /* make children equal height */
}

.results-container, .inputs-container {
    background: #fff;
    border-radius: 45px;
    padding: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
}

.inputs-container,
.results-container {
    flex: 1; /* equal width + height stretching */
}


/* Keep flex behavior for responsive widths */
.inputs-container { flex: 1 1 400px; min-width: 350px; }
.results-container { flex: 1 1 350px; min-width: 300px; }

/* Optional: ensure equal height dynamically */
@media (max-width: 900px) {
    .inputs-container,
    .results-container {
        min-height: auto; /* let it shrink naturally on tablets/mobile */
    }
}


h2 { text-align: left; font-size: 30px; font-weight: 700; margin-bottom: 0px; }
  h3 { text-align: left; font-size: 15px; font-weight: 500; margin-bottom: 45px; }
  h4 { text-align: left; font-size: 15px; font-weight: 500; margin-bottom: 15px; }

.section-divider {
    display: flex;
    align-items: center;
    margin: 25px 0 35px 0;
}
.section-divider::before, .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: #ddd;
}
.section-divider::before { margin-right: 10px; }
.section-divider::after { margin-left: 10px; }
.section-divider span { font-size: 10px; font-weight: 500; color: #888; white-space: nowrap; }

.roi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 18px;
    margin-bottom: 20px;
}

.input-group { display: flex; flex-direction: column; }

label { font-weight: 500; margin-bottom: 6px; font-size: 12px; }

input, select {
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 15px;
    height: 42px;
    line-height: 20px;
    box-sizing: border-box;
}

select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-color: white;
    background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14'><polygon points='0,0 14,0 7,7' fill='%23999'/></svg>");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 12px;
    padding-right: 30px;
    cursor: pointer;
}

input:focus, select:focus { 
    border-color: #005bff;
    box-shadow: 0 0 5px rgba(0,91,255,0.2);
    outline: none;
}

.calc-btn {
    width: 100%;
    padding: 14px;
    margin-top: 10px;
    font-size: 17px;
    background: #005bff;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
}
.calc-btn:hover { background: #003f9a; }

.total-roi-display {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 25px;
    height: 120px;
}
.total-roi-display span { font-size: 80px; font-weight: 800; color: #005bff; }

.result-card .label { font-weight: 500; margin-bottom: 6px; font-size: 12px; color: #555; }
.result-card .value { font-weight: 500; font-size: 12px; color: #1e0949; margin-bottom: 16px; }

.added-expense { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
.added-expense select, .added-expense input { flex: 1; }
.remove-btn { background: #ff4d4f; color: white; border: none; border-radius: 6px; padding: 0 8px; cursor: pointer; }

.download-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    padding: 15px;
    border-top: 1px solid #ddd;
    width: 100%;
    box-sizing: border-box;
}
.download-text {
    flex: 1 1 0;
    min-width: 0; 
    font-size: 14px;
    color: #555;
}
.download-btn { white-space: nowrap; }

.roi-columns {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: space-between;
    width: 100%;
    box-sizing: border-box;
}
.roi-column {
    flex: 1 1 0;
    min-width: 0;
    text-align: center;
    box-sizing: border-box;
}

/* ===================== */
/* Mobile / Responsive Fix */
/* ===================== */

/* Tablets & smaller screens */
@media (max-width: 900px) {
    body { padding: 0; } /* containers now touch edges */
    .container {
        flex-direction: column;
        gap: 20px;
        width: 100%;
        max-width: 100%;
        margin: 0;
        box-sizing: border-box;
    }
    .inputs-container, .results-container {
        width: 100% !important;
        min-width: 0;
        padding: 20px;
        border-radius: 0;
        box-sizing: border-box;
    }
    .roi-grid { grid-template-columns: 1fr; gap: 12px; }
    .total-roi-display span { font-size: 50px; }
    .calc-btn { font-size: 15px; }
}

/* Mobile Columns Stack */
@media (max-width: 600px) {
    .roi-columns {
        flex-direction: column !important;
        gap: 12px !important;
    }
    .roi-column {
        min-width: 0 !important;
        flex: 1 1 100% !important;
        text-align: center;
    }
}

/* Smallest screens (download section full-width) */
@media (max-width: 500px) {
    .download-container {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 10px;
    }
    .download-btn { width: 100% !important; }
    .download-text { text-align: center; }
}

/* ----------------------------- */
/* TAB NAVIGATION (FOLDER DESIGN) */
/* ----------------------------- */

.tab-container {
    width: 100%;
    margin-bottom: 25px;
    border-bottom: 1px solid #ddd;
    display: flex;
    overflow-x: auto;
}

.tab {
    padding: 14px 22px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    background: #f7f8fa;
    border: 1px solid #ddd;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    margin-right: 6px;
    transition: background 0.2s, color 0.2s;
    white-space: nowrap;
}

.tab.active {
    background: #fff;
    color: #005bff;
    border-bottom: 2px solid white;
}

.tab-content {
    display: none;
    animation: fadeIn 0.25s ease;
}

.tab-content.active {
    display: block;
}

/* Smooth fade transition */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Mobile improvements */
@media(max-width: 600px) {
    .tab {
        padding: 10px 16px;
        font-size: 13px;
    }
}

.disclaimer-box h3 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 8px;
    color: #1e0949;
}

.disclaimer-box p {
    font-size: 13px;
    margin-bottom: 12px;
    color: #555;
    line-height: 1.4;
}

.disclaimer-check input {
    margin-top: 2px;
    transform: scale(1.2);
    cursor: pointer;
}

    
/* FULL WIDTH — EACH TAB EQUAL SIZE */
.tab-container {
    width: 100%;
    display: flex;
    border-bottom: 1px solid #ddd;
    margin-bottom: 25px;
}

/* Tabs */
.tab {
    flex: 1;
    text-align: center;
    padding: 14px 0;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    background: #f7f8fa;
    border: 1px solid #ddd;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    transition: background 0.2s, color 0.2s;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;              /* spacing between icon + text */
    white-space: nowrap;
}

/* Tab icons */
.tab-icon {
    width: 18px;
    height: 18px;
    opacity: 0.65;
    transition: opacity 0.2s;
}

.tab:hover .tab-icon {
    opacity: 0.9;
}

/* Active tab */
.tab.active {
    background: #fff;
    color: #005bff;
    border-bottom: 2px solid white;
}

.tab.active .tab-icon {
    opacity: 1;
}

/* Mobile */
@media(max-width: 600px) {
    .tab { font-size: 12px; padding: 12px 0; }
    .tab-icon { width: 16px; height: 16px; }
}

.disabled {
    background-color: #ccc !important;
    color: #888 !important;
    cursor: not-allowed !important;
}

.value.disabled {
    color: #aaa !important;
}
/* MOBILE: tabs show ICON ONLY — no text */
@media (max-width: 600px) {

    /* Remove text by setting size to zero */
    .tab {
        font-size: 0 !important;
        gap: 0 !important;              /* no text, so no gap needed */
        justify-content: center !important;
    }

    /* Icons always visible */
    .tab .tab-icon {
        display: inline-block !important;
        width: 18px;
        height: 18px;
        opacity: 0.9;
    }

    /* Active tab icon a bit brighter (optional) */
    .tab.active .tab-icon {
        opacity: 1;
    }

    /* Ensure tabs remain full-width columns if desired */
    .tab {
        flex: 1 1 100%;
        text-align: center;
    }
}
  .suggestion-popup {
  display: none;
  font-size: 12px;
  color: #555;
  margin-top: 2px;
}


/* ======================================= */
/* FULL WIDTH STATS BLOCK (DESKTOP)        */
/* ======================================= */
.stats-fullwidth {
    width: 100%;
    max-width: 1200px;
    margin: 0px auto 0 auto;
    padding: 30px;
    background: #fff;
    border-radius: 45px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    box-sizing: border-box;
}

.stats-title {
    font-size: 18px;
    margin-bottom: 25px;
    font-weight: 600;
    color: #1e0949;
}

/* Stats grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
}

/* Individual stat boxes */
.stat-box {
    border: 0.5px solid #ddd;
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    background: #fafbfc;
}

.stat-label {
    font-size: 12px;
    color: #666;
    font-weight: 500;
    margin-bottom: 6px;
}

.stat-value {
    font-size: 16px;
    font-weight: 700;
    color: #1e0949;
}

/* Responsive for mobile */
@media (max-width: 800px) {
    .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 14px;
    }
}

@media (max-width: 500px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
}
.suggestions-box {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    z-index: 1000;
    max-height: 220px;
    overflow-y: auto;
    display: none;
}

.suggestion-item {
    padding: 10px 12px;
    font-size: 14px;
    cursor: pointer;
    border-bottom: 1px solid #f1f1f1;
}

.suggestion-item:last-child {
    border-bottom: none;
}

.suggestion-item:hover {
    background: #f4f0ff;
    color: #6327e5; /* matches your primary highlight color */
}
  
  /* ===================== */
/* Top two containers: 50/50 on desktop */
/* ===================== */
.container {
    display: flex;
    flex-wrap: wrap;       /* allows stacking on smaller screens */
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
    align-items: flex-start;
    box-sizing: border-box;
}

.inputs-container,
.results-container {
    background: #fff;
    border-radius: 45px;
    padding: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    box-sizing: border-box;   /* ensures padding does not overflow */
}

/* Desktop: exactly 50/50 */
@media (min-width: 901px) {
    .inputs-container,
    .results-container {
        flex: 1 1 calc(50% - 20px); /* 50% minus half of gap */
        min-width: 0;
    }
}

/* Tablets & smaller screens: stack */
@media (max-width: 900px) {
    .container {
        flex-direction: column;
        gap: 20px;
        width: 100%;
        padding: 0 20px; /* optional: reduce body overflow */
    }
    .inputs-container,
    .results-container {
        width: 100%;
        padding: 20px;
        border-radius: 30px;
    }
}

  /* Hidden by default */
#stickyCalcBar {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 12px;
  background: rgba(255,255,255,0.98);
  border-top: 1px solid #ddd;
  z-index: 9999;
  text-align: center;
}

/* Mobile only */
@media (max-width: 768px) {
  #stickyCalcBar {
    display: none; /* JS will toggle it */
  }

  #stickyCalcBar button {
    width: 90%;
    padding: 14px;
    border-radius: 10px;
    background: #6a39ff;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    border: none;
  }
}

/* Main layout */
.layout-wrapper {
  display: flex;
  gap: 40px;
  width: 100%;
  max-width: 1200px;
  min-height: 500px;

  margin: 40px auto;          /* 40px from top, centered horizontally */
  justify-content: center;     /* center left and right containers horizontally */
  align-items: stretch;        /* stretch children to full height */
}



/* All containers SAME background */
.container-left,
.small-container {
  background: #fff;
  border-radius: 40px;
  position: relative;
  overflow: hidden;
}

/* Left large container */
.container-left {
  flex: 7;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #fff;       /* plain white */
  border-radius: 40px;
  
  /* Ensure it has height */
  min-height: 500px;      /* same as layout-wrapper */
}



/* Right column */
.container-right {
  flex: 3;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* Small containers */
.small-container {
  flex: 1;
  position: relative;
  overflow: hidden;
}

/* ------------------------- */
/*  CHART STYLING (NEW)     */
/* ------------------------- */
.chart-wrapper {
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

svg {
  width: 100%;
  height: 100%;
}

.line {
  fill: none;
  stroke: #00c853;
  stroke-width: 3;
}

.area {
  fill: url(#gradient);
}

.x-axis text {
  font-size: 10px;
  text-anchor: middle;
  font-weight: 500;
  cursor: pointer;
}

.highlight-circle {
  fill: #00c853;
  opacity: 0.25;
}

.bubble {
  position: absolute;
  top: 20px;
  right: 20px;
  background: #00c853;
  color: #fff;
  padding: 10px 10px;
  border-radius: 25px;
  font-weight: 600;
  font-size: 12px;
  white-space: nowrap;
}

.left-label {
  position: absolute;
  top: 29px;
  left: 20px;
  font-size: 12px;
  color: #555;
  font-weight: 500;
}

/* MAP */
#map-container {
  width: 100%;
  height: 100%;
  border-radius: 30px;
  overflow: hidden;
  position: relative;
}

.tooltip {
  position:absolute;
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:6px 10px;
  border-radius:4px;
  font-size:13px;
  opacity:0;
  pointer-events:none;
  white-space:nowrap;
}

.state {
  fill:#130328;
  stroke:#fff;
  stroke-width:.5;
  cursor:pointer;
  transition:fill .3s, stroke .3s;
}
.state:hover {
  fill:#ff6b6b;
  stroke:#333;
}

/* Responsive */
@media (max-width: 900px) {
  .layout-wrapper { flex-direction: column; }
  .container-right { flex-direction: row; }
}

  </style>

  <!-- External JS libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>

<body>

<!-- HEADER -->
<header style="display:flex; align-items:center; padding:0 30px; height:80px; position:relative;">

  <!-- LOGO -->
  <div class="logo" style="z-index:2;">
    <img src="https://static.wixstatic.com/shapes/1799ca_f9630561313e4b2d9933265603bc6a0c.svg" alt="Logo">
  </div>

  <!-- CENTER NAV -->
  <nav id="nav-menu" style="flex:1; display:flex; justify-content:center; gap:30px; align-items:center; z-index:1;">

    <!-- CALCULATE -->
    <div class="calculate">
      <a href="#">Calculate</a>
      <div class="submenu">
        <div class="submenu-inner">
          <div class="submenu-left">

            <a href="calculator.html"><div class="submenu-item"><div><div class="submenu-title">Residential</div><div class="submenu-subtitle">Buy your dream home</div></div><span class="material-symbols-outlined submenu-icon">home</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Commercial</div><div class="submenu-subtitle">Office & Retail Spaces</div></div><span class="material-symbols-outlined submenu-icon">apartment</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Luxury</div><div class="submenu-subtitle">High-end Properties</div></div><span class="material-symbols-outlined submenu-icon">diamond</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Property Mgmt</div><div class="submenu-subtitle">Manage your assets</div></div><span class="material-symbols-outlined submenu-icon">folder_shared</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Tenant Portal</div><div class="submenu-subtitle">Access anytime</div></div><span class="material-symbols-outlined submenu-icon">key</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Reports</div><div class="submenu-subtitle">Track performance</div></div><span class="material-symbols-outlined submenu-icon">bar_chart</span></div></a>

          </div>

          <div class="submenu-right map-container">
            <div id="map"></div>
            <div class="tooltip" id="tooltip"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- MANAGE -->
    <div class="manage">
      <a href="#">Manage</a>
      <div class="submenu">
        <div class="submenu-inner">

          <div class="submenu-left">
            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Property Mgmt</div><div class="submenu-subtitle">Manage your assets</div></div><span class="material-symbols-outlined submenu-icon">folder_shared</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Tenant Portal</div><div class="submenu-subtitle">Access anytime</div></div><span class="material-symbols-outlined submenu-icon">key</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Reports</div><div class="submenu-subtitle">Track performance</div></div><span class="material-symbols-outlined submenu-icon">bar_chart</span></div></a>
          </div>

          <div class="submenu-right media-box">
            <video src="https://www.w3schools.com/html/mov_bbb.mp4" autoplay muted loop playsinline></video>
            <div class="media-text">
              <h4>Portfolio Insights</h4>
              <p>Track your property performance in real time.</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ESTIMATE -->
    <div class="estimate">
      <a href="#">Estimate</a>
      <div class="submenu">
        <div class="submenu-inner">

          <div class="submenu-left">
            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Consulting</div><div class="submenu-subtitle">Professional advice</div></div><span class="material-symbols-outlined submenu-icon">business_center</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Valuation</div><div class="submenu-subtitle">Property appraisals</div></div><span class="material-symbols-outlined submenu-icon">straighten</span></div></a>

            <a href="#"><div class="submenu-item"><div><div class="submenu-title">Marketing</div><div class="submenu-subtitle">Promote your property</div></div><span class="material-symbols-outlined submenu-icon">campaign</span></div></a>
          </div>

          <div class="submenu-right media-box">
            <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600" alt="Service" />
            <div class="media-text">
              <h4>Expert Services</h4>
              <p>Tailored strategies for your success.</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div><a href="#">Calculate</a></div>
    <div><a href="#">Manage</a></div>
    <div><a href="#">Estimate</a></div>


     <!-- AI AGENT LINK WITH "NEW" BUBBLE -->
<div class="ai-agent-container">
  <a href="#" class="ai-agent-link">
    AI Agent
    <span class="ai-new-bubble">NEW</span>
  </a>
</div>


  </nav>

  <!-- RIGHT: SIGN IN / SIGN UP -->
  <div class="nav-right-group" style="display:flex; gap:26px; align-items:center; z-index:2;">
    <a href="#" style="color:#6327e5; font-weight:600; font-size:13px;">Sign In</a>
    <a href="#" style="
      padding:10px 20px;
      background:#6327e5;
      color:#fff;
      border-radius:999px;
      font-size:12px;
      font-weight:600;">
      Sign Up
    </a>
  </div>

  <!-- MOBILE MENU -->
  <ul class="mobile-menu">
    <li>
      <a href="#">Buy <span class="arrow">expand_more</span></a>
      <ul class="submenu">
        <li><a href="#"><span class="submenu-icon">home</span>Residential</a></li>
        <li><a href="#"><span class="submenu-icon">apartment</span>Commercial</a></li>
        <li><a href="#"><span class="submenu-icon">diamond</span>Luxury</a></li>
        <li><a href="#"><span class="submenu-icon">folder_shared</span>Property Mgmt</a></li>
        <li><a href="#"><span class="submenu-icon">key</span>Tenant Portal</a></li>
        <li><a href="#"><span class="submenu-icon">bar_chart</span>Reports</a></li>
      </ul>
    </li>

    <li>
      <a href="#">Manage <span class="arrow">expand_more</span></a>
      <ul class="submenu">
        <li><a href="#"><span class="submenu-icon">folder_shared</span>Property Mgmt</a></li>
        <li><a href="#"><span class="submenu-icon">key</span>Tenant Portal</a></li>
        <li><a href="#"><span class="submenu-icon">bar_chart</span>Reports</a></li>
      </ul>
    </li>

    <li>
      <a href="#">Services <span class="arrow">expand_more</span></a>
      <ul class="submenu">
        <li><a href="#"><span class="submenu-icon">business_center</span>Consulting</a></li>
        <li><a href="#"><span class="submenu-icon">straighten</span>Valuation</a></li>
        <li><a href="#"><span class="submenu-icon">campaign</span>Marketing</a></li>
      </ul>
    </li>

    <li><a href="#">Developers</a></li>
    <li><a href="#">Company</a></li>
    <li><a href="#" class="btn-bubble">Sign In</a></li>
  </ul>

</header>
  
<div class="main-content">
<div class="container">
  <div class="inputs-container">
  <h2>See your next real estate investment in numbers</h2>
  <h3>Estimate cash flow, ROI, and leverage to make smarter property decisions</h3>

<div class="tab-container">
    
    <div class="tab active" data-tab="key-details">
        <img src="https://static.wixstatic.com/shapes/1799ca_d59ee459f9db45a3b99a62cdfa84e724.svg" 
             class="tab-icon">
        Key Details
    </div>

    <div class="tab" data-tab="financing">
        <img src="https://static.wixstatic.com/shapes/1799ca_0e0026550151414baae6bfb1ce82c752.svg" 
             class="tab-icon">
        Financing
    </div>

    <div class="tab" data-tab="operating">
        <img src="https://static.wixstatic.com/shapes/1799ca_dbd6c6293d664fe1a55914fb987667b3.svg" 
             class="tab-icon">
        Expenses
    </div>

</div>



  <!-- TAB CONTENT WRAPPER (fixed) -->
 <div id="tab-key-details" class="tab-content active">
  <div class="roi-grid">

    
     <div class="input-group">
<label>
  Purchase Price ($)
  <span class="info" title="Enter the total purchase price of the property.">ⓘ</span>
</label>
      <input type="text" id="purchasePrice" placeholder="500,000">
    </div>
    
 <div class="input-group">
  <label>
    Monthly Rent ($)
    <span class="info" title="Expected monthly rental income from tenants.">ⓘ</span>
  </label>
  <input type="text" id="rentIncome" placeholder="2,350" data-suggest="2350">
  <div class="suggestion-popup" id="rentSuggestion">Suggested: $2,350</div>
</div>

<div class="input-group">
  <label>
    Appreciation Rate (%)
    <span class="info" title="Expected annual percentage increase in the property value.">ⓘ</span>
  </label>
  <input type="text" id="appreciationRate" placeholder="9.2" data-suggest="9.2">
  <div class="suggestion-popup" id="appSuggestion">Suggested: 9.2%</div>
</div>

    <div class="input-group">
<label>
  Years to Hold
  <span class="info" title="How long you plan to keep the property before selling.">ⓘ</span>
</label>
      <select id="yearsHold">
        <option value="1">1 Year</option>
        <option value="3">3 Years</option>
        <option value="5" selected>5 Years</option>
        <option value="7">7 Years</option>
        <option value="10">10 Years</option>
        <option value="15">15 Years</option>
      </select>
    </div>
<!-- Property Type -->
<div class="input-group">
  <label>
    Property Type 
    <span class="info" title="Select the type of residential investment property.">ⓘ</span>
  </label>
  <select id="propertyType">
    <option value="Single Family">Single Family</option>
    <option value="Condo">Condo</option>
    <option value="Townhouse">Townhouse</option>
    <option value="Duplex">Duplex</option>
    <option value="Triplex">Triplex</option>
    <option value="Fourplex">Fourplex</option>
  </select>
</div>

<!-- Market: City + State -->
<div class="input-group">
  <label>
    Market (City & State)
    <span class="info" title="Your investment market. Auto-detected but you can edit manually.">ⓘ</span>
  </label>
  <div style="display:flex; gap:10px; position: relative;">
    <input type="text" id="marketLocation" placeholder="City, State" autocomplete="off">
    <div id="citySuggestions" class="suggestions-box"></div>
  </div>
</div>


  </div>
</div>


  <div id="tab-financing" class="tab-content">
      <div class="roi-grid">
        <div class="input-group">
          <label>Down Payment (%)</label>
          <input type="number" id="downPaymentPercent" placeholder="30">
        </div>

        <div class="input-group">
          <label>Cash Investment ($)</label>
          <input type="text" id="cashInvestment" placeholder="150,000">
        </div>

        <div class="input-group">
          <label>Financed Amount ($)</label>
          <input type="text" id="loanAmount" placeholder="350,000">
        </div>

        <div class="input-group">
          <label>Mortgage Rate (%)</label>
          <input type="number" id="mortgageRate" placeholder="6.25" step="0.01">
        </div>

        <div class="input-group">
          <label>Mortgage Term (Years)</label>
          <input type="number" id="mortgageTerm" placeholder="30">
        </div>
      </div>
  </div>

  <div id="tab-operating" class="tab-content">
      <div class="roi-grid">
          <div class="input-group">
              <label>Property Taxes ($/yr)</label>
              <input type="text" id="taxes" placeholder="3,500">
          </div>

          <div class="input-group">
              <label>Homeowner’s Insurance ($/yr)</label>
              <input type="text" id="insurance" placeholder="1,500">
          </div>

          <div class="input-group">
              <label>HOA ($/mo)</label>
              <input type="text" id="hoa" placeholder="250">
          </div>

          <div class="input-group">
              <label>Management Fees (%)</label>
              <input type="number" id="managementFees" placeholder="8">
          </div>

          <div class="input-group">
              <label>Vacancy Rate (%)</label>
              <input type="number" id="vacancyRate" placeholder="5">
          </div>

          <div id="expensesContainer">
              <div class="input-group" id="addExpenseWrapper">
                  <label style="visibility:hidden;">Add Expense</label>
                  <input type="text" id="addExpenseInput" placeholder="+ Add Expense"
                        readonly style="cursor:pointer;">
              </div>
          </div>
      </div>
  </div>

  <!-- ⬅ THIS CLOSING DIV WAS IN THE WRONG PLACE BEFORE -->


<div class="calculate-container">
  <button id="calculateBtn" class="calc-btn" onclick="calculateROI()">Calculate ROI</button>
</div>

<!-- Sticky button that appears only after scrolling -->
<div id="stickyCalcBar">
  <button id="stickyCalculateBtn">Calculate ROI</button>
</div>

  </div>


<!-- Results Column -->
<div class="results-container">
  <h4>Investment Results</h4>

  <!-- Main ROI Display -->
  <div class="total-roi-display">
    <span id="resultTotalROILarge">$0</span>
  </div>

  <!-- Detailed Metrics -->
  <div class="roi-columns" style="display:flex; flex-wrap:wrap; gap:15px; justify-content:space-between; margin-top:20px;">

    <!-- Equity Build-Up -->
    <div class="roi-column" style="flex:1; min-width:140px; text-align:center;">
      <div class="label">
        Equity Build-Up <span class="info" title="Estimated property equity after loan payoff and appreciation over holding period.">ⓘ</span>
      </div>
      <div class="value" id="resultCashFlowColumn">- n/a</div>
    </div>

    <!-- Net Operating Income -->
    <div class="roi-column" style="flex:1; min-width:140px; text-align:center;">
      <div class="label">
        Net Operating Income <span class="info" title="Total rental income minus operating expenses, before debt service.">ⓘ</span>
      </div>
      <div class="value" id="resultNOIColumn">- n/a</div>
    </div>

    <!-- Total Rental Income -->
    <div class="roi-column" style="flex:1; min-width:140px; text-align:center;">
      <div class="label">
        Total Rental Income <span class="info" title="Cumulative rental income expected during the holding period.">ⓘ</span>
      </div>
      <div class="value" id="resultCoCColumn">- n/a</div>
    </div>

  </div>
<!-- Disclaimer + Checkbox -->
<div class="disclaimer-box">
    <!-- Title -->
    <h4>Calculator Disclaimer</h4>
    <!-- Subtitle / Explanation -->
    <p>
        These calculators are for <strong>informational purposes only</strong>. Results are estimates and may not reflect your exact situation. We do not provide financial, legal, or tax advice, and you should verify results independently before making decisions.
        By using these calculators, you agree that you use them at your own risk, and we are not liable for any losses or damages resulting from their use.
    </p>
  
</div>



  <!-- Text + Button Container -->
  <div class="download-container" style="display:flex; justify-content:space-between; align-items:center; margin-top:30px; padding:15px; border-top:1px solid #ddd;">
    <div class="download-text" style="flex:1; font-size:14px; color:#555;">
      Generate a detailed PDF report of your investment metrics, including charts and summaries.
    </div>
    <button onclick="downloadPDF()" class="download-btn" style="padding:10px 20px; background-color:#005bff; color:#fff; border:none; border-radius:6px; cursor:pointer;">
      Download PDF
    </button>
  </div>
</div>
  <!-- =============================== -->
<!-- FULL-WIDTH STATS CONTAINER     -->
<!-- =============================== -->
<div class="stats-fullwidth">
    <h4 class="stats-title">Additional Investment Metrics</h4>

    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-label">Cap Rate</div>
            <div class="stat-value" id="capRateValue">- n/a</div>
        </div>

        <div class="stat-box">
            <div class="stat-label">Annual Yield</div>
            <div class="stat-value" id="yieldValue">- n/a</div>
        </div>

        <div class="stat-box">
            <div class="stat-label">Expense Ratio</div>
            <div class="stat-value" id="expenseRatioValue">- n/a</div>
        </div>

        <div class="stat-box">
            <div class="stat-label">Debt Coverage Ratio (DCR)</div>
            <div class="stat-value" id="dcrValue">- n/a</div>
        </div>
    </div>
</div>
</div>

  <div class="layout-wrapper">

  <!-- LEFT BIG -->
  <div class="container-left">
     <!-- Text + Button Container -->
  <div class="download-container" style="display:flex; justify-content:space-between; align-items:center; margin-top:30px; padding:15px; border-top:1px solid #ddd;">
    <div class="download-text" style="flex:1; font-size:14px; color:#555;">
      Generate a detailed PDF report of your investment metrics, including charts and summaries.
    </div>
    <button onclick="downloadPDF()" class="download-btn" style="padding:10px 20px; background-color:#005bff; color:#fff; border:none; border-radius:6px; cursor:pointer;">
      Download PDF
    </button>
  </div>

  <!-- RIGHT SIDE -->
  <div class="container-right">

    <!-- TOP SMALL CONTAINER — NOW CONTAINS THE STOCK CHART -->
    <div class="small-container">
      <div class="chart-wrapper">
        <div class="left-label">Performance Overview</div>
        <div class="bubble" id="bubble">+18.92%</div>
        <svg id="stockChart">
          <defs>
            <linearGradient id="gradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#00c853" stop-opacity="0.2"/>
              <stop offset="100%" stop-color="#00c853" stop-opacity="0"/>
            </linearGradient>
          </defs>
          <path class="area"></path>
          <path class="line"></path>
          <circle class="highlight-circle" r="20"></circle>
          <g class="x-axis"></g>
        </svg>
      </div>
    </div>

    <!-- BOTTOM SMALL CONTAINER — MAP -->
    <div class="small-container">
      <div id="map-container">
        <div class="tooltip" id="tooltip"></div>
      </div>
    </div>

  </div>
</div>

  
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script>
/* ---------------- CHART LOGIC ---------------- */
const svg = document.getElementById('stockChart');
const years = ["1Y","2Y","3Y","5Y","10Y"];
const mainFocusIndex = 3;

const performanceValues = {
    "1Y": "+4.23%",
    "2Y": "-2.87%",
    "3Y": "+6.44%",
    "5Y": "+18.92%",
    "10Y": "+32.15%"
};

function drawChart(){
    const width = svg.clientWidth;
    const height = svg.clientHeight;

    const lineStart = 0;
    const lineEnd = width;

    const axisStart = width * 0.15;
    const axisEnd   = width * 0.85;
    const spacing = (axisEnd - axisStart) / (years.length - 1);

    const labelY = height - 30;

    const points = [
      {x: lineStart, y: height*0.65},
      {x: axisStart + spacing*0, y: height*0.64},
      {x: axisStart + spacing*1, y: height*0.75},
      {x: axisStart + spacing*2, y: height*0.72},
      {x: axisStart + spacing*3, y: height*0.65},
      {x: axisEnd, y: height*0.35},
      {x: lineEnd, y: height*0.32}
    ];

    const linePath = points.map((p,i)=> (i===0?'M':'L') + p.x + ',' + p.y).join('');
    svg.querySelector('.line').setAttribute('d', linePath);

    const areaPath = linePath + `L${lineEnd},${height} L${lineStart},${height} Z`;
    svg.querySelector('.area').setAttribute('d', areaPath);

    const xAxis = svg.querySelector('.x-axis');
    xAxis.innerHTML = "";

    years.forEach((year,i)=>{
        const x = axisStart + spacing*i;

        const el = document.createElementNS("http://www.w3.org/2000/svg","text");
        el.setAttribute("x", x);
        el.setAttribute("y", labelY);
        el.textContent = year;
        el.style.cursor = "pointer";

        el.setAttribute("fill", i === mainFocusIndex ? "#000" : "rgba(0,0,0,0.55)");
        el.setAttribute("font-weight", i === mainFocusIndex ? "700" : "500");

        el.addEventListener("click", ()=> updateSelection(year, x, labelY - 5));

        xAxis.appendChild(el);
    });

    updateSelection("5Y", axisStart + spacing*mainFocusIndex, labelY - 5);
}

function updateSelection(year, x, y){
    const circle = svg.querySelector('.highlight-circle');
    const bubble = document.getElementById('bubble');

    circle.setAttribute('cx', x);
    circle.setAttribute('cy', y);

    bubble.textContent = performanceValues[year];
}

window.addEventListener("resize", drawChart);
drawChart();

/* ---------------- MAP LOGIC ---------------- */
d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(topojsonData => {
  const states = topojson.feature(topojsonData, topojsonData.objects.states);
  const width = 960, height = 600;
  const svgMap = d3.select("#map-container").append("svg")
      .attr("viewBox", [0, 0, width, height])
      .style("width", "100%")
      .style("height", "auto");

  const projection = d3.geoAlbersUsa()
      .translate([width / 2, height / 2])
      .scale(1000);

  const path = d3.geoPath().projection(projection);
  const tooltip = d3.select("#tooltip");

  svgMap.selectAll("path.state")
     .data(states.features)
     .enter()
     .append("path")
     .attr("class", "state")
     .attr("d", path)
     .on("mouseenter", (event, d) => {
        tooltip.html(d.properties.name).style("opacity", 1);
     })
     .on("mousemove", (event) => {
        tooltip.style("left", event.offsetX + 15 + "px")
               .style("top", event.offsetY - 10 + "px");
     })
     .on("mouseleave", () => {
        tooltip.style("opacity", 0);
     });
});

  // =========================================
// LOAD HEADER
// =========================================

  fetch('header.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-container').innerHTML = data;
    })
    .catch(err => console.error('Error loading header:', err));

// =========================================
// Top 200+ US cities for autocomplete
// =========================================
const topCities = [
  "New York, NY","Los Angeles, CA","Chicago, IL","Houston, TX","Phoenix, AZ",
  "Philadelphia, PA","San Antonio, TX","San Diego, CA","Dallas, TX","San Jose, CA",
  "Austin, TX","Jacksonville, FL","Fort Worth, TX","Columbus, OH","Charlotte, NC",
  "San Francisco, CA","Indianapolis, IN","Seattle, WA","Denver, CO","Washington, DC",
  "Boston, MA","El Paso, TX","Nashville, TN","Detroit, MI","Oklahoma City, OK",
  "Portland, OR","Las Vegas, NV","Memphis, TN","Louisville, KY","Baltimore, MD",
  "Milwaukee, WI","Albuquerque, NM","Tucson, AZ","Fresno, CA","Sacramento, CA",
  "Kansas City, MO","Long Beach, CA","Mesa, AZ","Atlanta, GA","Colorado Springs, CO",
  "Virginia Beach, VA","Raleigh, NC","Omaha, NE","Miami, FL","Oakland, CA",
  "Minneapolis, MN","Tulsa, OK","Wichita, KS","New Orleans, LA","Arlington, TX",
  // ... add remaining cities to reach 200+
];

// =========================================
// AUTOCOMPLETE FUNCTION
// =========================================
function autocomplete(inp, arr) {
  let currentFocus;

  inp.addEventListener("input", function() {
    let val = this.value;
    closeAllLists();
    if (!val) return false;
    currentFocus = -1;

    const listDiv = document.createElement("DIV");
    listDiv.setAttribute("id", this.id + "-autocomplete-list");
    listDiv.setAttribute("class", "autocomplete-items");
    listDiv.style.border = "1px solid #ccc";
    listDiv.style.borderTop = "none";
    listDiv.style.position = "absolute";
    listDiv.style.backgroundColor = "#fff";
    listDiv.style.zIndex = "99";
    listDiv.style.maxHeight = "200px";
    listDiv.style.overflowY = "auto";
    this.parentNode.appendChild(listDiv);

    arr.forEach(city => {
      if (city.toLowerCase().includes(val.toLowerCase())) {
        const item = document.createElement("DIV");
        item.innerHTML = city.replace(new RegExp(val, "i"), match => `<strong>${match}</strong>`);
        item.style.padding = "5px";
        item.style.cursor = "pointer";
        item.addEventListener("click", function() {
          inp.value = city;
          closeAllLists();
        });
        listDiv.appendChild(item);
      }
    });
  });

  inp.addEventListener("keydown", function(e) {
    let x = document.getElementById(this.id + "-autocomplete-list");
    if (x) x = x.getElementsByTagName("div");
    if (e.keyCode == 40) { // down
      currentFocus++;
      addActive(x);
    } else if (e.keyCode == 38) { // up
      currentFocus--;
      addActive(x);
    } else if (e.keyCode == 13) { // enter
      e.preventDefault();
      if (currentFocus > -1) if (x) x[currentFocus].click();
    }
  });

  function addActive(x) {
    if (!x) return false;
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = x.length - 1;
    x[currentFocus].classList.add("autocomplete-active");
    x[currentFocus].style.backgroundColor = "#e9e9e9";
  }

  function removeActive(x) {
    for (let i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
      x[i].style.backgroundColor = "#fff";
    }
  }

  function closeAllLists(elmnt) {
    const x = document.getElementsByClassName("autocomplete-items");
    for (let i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) x[i].parentNode.removeChild(x[i]);
    }
  }

  document.addEventListener("click", function (e) {
    closeAllLists(e.target);
  });
}

// =========================================
// AUTO-DETECT LOCATION
// =========================================
function autoDetectLocation() {
  fetch("https://ipapi.co/json/")
    .then(res => res.json())
    .then(data => {
      let city = data.city || "";
      let state = data.region || "";
      if (city || state) {
        const marketInput = document.getElementById("marketLocation");
        marketInput.value = `${city}${city && state ? ", " : ""}${state}`;
        marketInput.dispatchEvent(new Event("input")); // triggers autocomplete suggestions
      }
    })
    .catch(err => console.warn("Location lookup failed:", err));
}

// Initialize
window.addEventListener("load", () => {
  autocomplete(document.getElementById("marketLocation"), topCities);
  autoDetectLocation();
});
/* =========================================
   FORMAT NUMBERS WITH COMMAS
========================================= */
function formatWithCommas(input) {
    let value = input.value.replace(/[^\d]/g, '');
    input.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

/* =========================================
   ANIMATE VALUE DISPLAY
========================================= */
function animateValue(id, start, end, duration) {
    const el = document.getElementById(id);
    if (!el) return;
    const range = end - start;
    const startTime = performance.now();

    function frame(now) {
        const progress = Math.min((now - startTime) / duration, 1);
        const value = start + range * progress;
        el.innerText = "$" + Math.floor(value).toLocaleString();
        if (progress < 1) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
}

/* =========================================
   DYNAMIC EXPENSES
========================================= */
const expenseTypes = [
    "Repairs & Maintenance",
    "Legal Fees",
    "Vacancy Cost",
    "Bookkeeping & Accounting",
    "Bank Fees",
    "Other"
];

function activateAddExpense() {
    const wrapper = document.getElementById("addExpenseWrapper");
    const addInput = document.getElementById("addExpenseInput");

    addInput.onclick = () => {
        wrapper.innerHTML = "";
        const select = document.createElement("select");
        select.innerHTML = `<option value="">Select Expense</option>` +
            expenseTypes.map(t => `<option value="${t}">${t}</option>`).join("");
        wrapper.appendChild(select);

        select.onchange = () => {
            if (!select.value) return;

            const row = document.createElement("div");
            row.className = "input-group added-expense";
            row.innerHTML = `
                <label>${select.value}</label>
                <input type="text" class="expenseValue" placeholder="Amount">
                <button type="button" class="remove-btn">✕</button>
            `;
            row.querySelector(".expenseValue").oninput = e => formatWithCommas(e.target);
            row.querySelector(".remove-btn").onclick = () => row.remove();

            wrapper.parentElement.insertBefore(row, wrapper);

            wrapper.innerHTML = `
                <label style="visibility:hidden;">Add Expense</label>
                <input type="text" id="addExpenseInput" placeholder="+ Add Expense" readonly style="cursor:pointer;">
            `;
            activateAddExpense();
        };
    };
}
activateAddExpense();

function calculateTotalExpenses() {
    let total = 0;
    document.querySelectorAll('.expenseValue').forEach(exp => {
        total += Number(exp.value.replace(/,/g, '')) || 0;
    });
    return total;
}

let roiChart;

function renderROIChart(totalROI, cashFlow, NOI, coc) {
    const ctxEl = document.getElementById('roiChart');
    if (!ctxEl) return;

    const ctx = ctxEl.getContext('2d');
    if (roiChart) roiChart.destroy();

    roiChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total ROI', 'Cash Flow', 'NOI', 'Cash-on-Cash'],
            datasets: [{
                data: [totalROI, cashFlow, NOI, coc],
                backgroundColor: ['#005bff', '#00c851', '#ffbb33', '#ff4444']
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
}

function calculateROI() {

    const rentInput = document.getElementById('rentIncome');
    const appInput = document.getElementById('appreciationRate');

    // Default values
    const defaultRent = 2350;
    const defaultApp = 9.2;

    // If no input, prompt user but let them continue
    if (!rentInput.value || !appInput.value) {
        const proceed = confirm(
            "No Rent or Appreciation Rate entered. We'll use average market values (Rent: $2,350, Appreciation: 9.2%) for best results. Continue?"
        );
        if (!proceed) return; // Stop calculation if user cancels
    }

    const rent = Number(rentInput.value.replace(/,/g, '')) || defaultRent;
    const appreciationRate = (Number(appInput.value.replace(/,/g, '')) || defaultApp) / 100;

    // ---------- Other inputs ----------
    const getVal = id => Number(document.getElementById(id)?.value.replace(/,/g, '')) || 0;
    const purchasePrice = getVal('purchasePrice');
    const years = Number(document.getElementById('yearsHold')?.value) || 0;

    const cashInvestment = getVal('cashInvestment');
    const loan = getVal('loanAmount');
    const mortgageRateMonthly = ((Number(document.getElementById('mortgageRate')?.value) || 0) / 100) / 12;
    const mortgageTermMonths = (Number(document.getElementById('mortgageTerm')?.value) || 0) * 12;

    const taxes = getVal('taxes');
    const insurance = getVal('insurance');
    const hoaAnnual = getVal('hoa') * 12;
    const vacancyRate = (Number(document.getElementById('vacancyRate')?.value) || 0) / 100;
    const mgmtRate = (Number(document.getElementById('managementFees')?.value) || 0) / 100;
    const dynamicExpenses = calculateTotalExpenses();

    // ---------- Base ROI ----------
    const totalRentCollected = rent * 12 * years;
    const futureValue = purchasePrice * Math.pow(1 + appreciationRate, years);
    const appreciationGain = futureValue - purchasePrice;
    let baseROI = totalRentCollected + appreciationGain;

    // ---------- Financing ----------
    let mortgagePayment = 0;
    if (loan > 0 && mortgageRateMonthly > 0 && mortgageTermMonths > 0) {
        mortgagePayment = loan * (mortgageRateMonthly * Math.pow(1 + mortgageRateMonthly, mortgageTermMonths)) /
                          (Math.pow(1 + mortgageRateMonthly, mortgageTermMonths) - 1);
    }

    let mortgagePaidOff = 0;
    if (loan > 0 && mortgageRateMonthly > 0 && years > 0) {
        mortgagePaidOff = loan - (loan * Math.pow(1 + mortgageRateMonthly, mortgageTermMonths - years * 12));
        mortgagePaidOff = mortgagePaidOff > 0 ? mortgagePaidOff : 0;
    }

    const monthlyVacancyAdjustedRent = rent * (1 - vacancyRate);
    const monthlyOperatingExpenses = (taxes + insurance + dynamicExpenses) / 12 + (hoaAnnual / 12) + (rent * mgmtRate);
    const monthlyCashFlow = monthlyVacancyAdjustedRent - monthlyOperatingExpenses - mortgagePayment;
    const annualCashFlow = monthlyCashFlow * 12;
    const NOI = (monthlyVacancyAdjustedRent * 12) - (monthlyOperatingExpenses * 12);
    const CoC = cashInvestment > 0 ? (annualCashFlow / cashInvestment) * 100 : 0;

    const totalExpenses = (monthlyOperatingExpenses + mortgagePayment) * 12 * years;
    const totalROI = purchasePrice + totalRentCollected + appreciationGain - totalExpenses + mortgagePaidOff;

    // ---------- Display & Chart ----------
    animateValue("resultTotalROILarge", 0, totalROI, 1000);
    document.getElementById("resultCashFlowColumn").innerText = "Equity: $" + Math.floor(futureValue - loan).toLocaleString();
    document.getElementById("resultNOIColumn").innerText = "Gain: $" + Math.floor(appreciationGain).toLocaleString();
    document.getElementById("resultCoCColumn").innerText = "Total Rent: $" + Math.floor(totalRentCollected).toLocaleString();

    const capRate = purchasePrice ? (NOI / purchasePrice) * 100 : 0;
    const annualYield = cashInvestment ? (annualCashFlow / cashInvestment) * 100 : 0;
    const totalOperatingExpenses = taxes + insurance + hoaAnnual + dynamicExpenses + (rent * mgmtRate);
    const expenseRatio = totalRentCollected ? (totalOperatingExpenses / totalRentCollected) * 100 : 0;
    const DCR = mortgagePayment > 0 ? (NOI / (mortgagePayment * 12)) : 0;

    document.getElementById("capRateValue").innerText = capRate.toFixed(2) + "%";
    document.getElementById("yieldValue").innerText = annualYield.toFixed(2) + "%";
    document.getElementById("expenseRatioValue").innerText = expenseRatio.toFixed(2) + "%";
    document.getElementById("dcrValue").innerText = DCR.toFixed(2);

    renderROIChart(totalROI, annualCashFlow, NOI, CoC);
}



/* =========================================
   AUTO-FORMAT INPUTS
========================================= */
document.querySelectorAll('#purchasePrice,#cashInvestment,#loanAmount,#taxes,#insurance,#hoa,#rentIncome')
    .forEach(input => input.addEventListener('input', () => formatWithCommas(input)));

/* =========================================
   TABS
========================================= */
document.querySelectorAll('.tab-container .tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab-container .tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const contentEl = document.getElementById("tab-" + tab.dataset.tab);
        if (contentEl) contentEl.classList.add('active');
    });
});

/* =========================================
   TOOLTIP USING TITLE
========================================= */
document.querySelectorAll('.info').forEach(el => {
    el.addEventListener('mouseenter', () => {
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.style.position = 'absolute';
        tooltip.style.background = '#000';
        tooltip.style.color = '#fff';
        tooltip.style.padding = '4px 8px';
        tooltip.style.borderRadius = '4px';
        tooltip.style.fontSize = '12px';
        tooltip.style.zIndex = 1000;
        tooltip.innerText = el.title;
        document.body.appendChild(tooltip);

        const rect = el.getBoundingClientRect();
        tooltip.style.left = rect.left + window.scrollX + "px";
        tooltip.style.top = rect.bottom + window.scrollY + "px";

        el.addEventListener('mouseleave', () => tooltip.remove(), { once: true });
    });
});

/* =========================================
   PDF GENERATOR
========================================= */
function downloadPDF() {
    const agree = document.getElementById("disclaimerAgree");
    if (!agree.checked) {
        alert("Please accept the disclaimer to download the PDF.");
        return;
    }

    const element = document.getElementById('reportSection');
    if (!element) return;
    element.style.display = "block";

    html2canvas(element, { scale: 2 }).then(canvas => {
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        const width = pdf.internal.pageSize.getWidth();
        const height = canvas.height * width / canvas.width;

        pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, width, height);
        pdf.save("Investment_Report.pdf");
        element.style.display = "none";
    });
}

function initSuggestedInputs() {
  const inputs = [
    { id: "rentIncome", min: 1, max: 999999, step: 1 },
    { id: "appreciationRate", min: 0.1, max: 99.9, step: 0.1 }
  ];

  inputs.forEach(cfg => {
    const input = document.getElementById(cfg.id);
    const suggest = Number(input.dataset.suggest);
    const popup = document.getElementById(cfg.id + "Suggestion");

    // Show popup on focus
    input.addEventListener("focus", () => {
      popup.style.display = "block";
      if (!input.value) input.value = suggest;
    });

    input.addEventListener("blur", () => {
      setTimeout(() => popup.style.display = "none", 200);
      if (Number(input.value) === suggest) input.value = ""; // restore placeholder
    });

    // Up/Down arrows
    input.addEventListener("keydown", e => {
      let val = parseFloat(input.value.replace(/,/g,'')) || suggest;

      if (e.key === "ArrowUp") {
        e.preventDefault();
        val += cfg.step;
        if (val > cfg.max) val = cfg.max;
        input.value = cfg.id === "rentIncome" ? Math.round(val).toLocaleString() : val;
      } else if (e.key === "ArrowDown") {
        e.preventDefault();
        val -= cfg.step;
        if (val < cfg.min) val = cfg.min;
        input.value = cfg.id === "rentIncome" ? Math.round(val).toLocaleString() : val;
      }
    });

    // Input formatting
    input.addEventListener("input", () => {
      let num = parseFloat(input.value.replace(/[^0-9.]/g,''));
      if (isNaN(num)) return;
      if (cfg.id === "rentIncome") {
        input.value = Math.min(Math.max(num, cfg.min), cfg.max).toLocaleString();
      } else {
        input.value = Math.min(Math.max(num, cfg.min), cfg.max);
      }
    });
  });
}

window.addEventListener("load", initSuggestedInputs);
function watchCalculateButton() {
  const mainBtn = document.getElementById("calculateBtn");
  const stickyBar = document.getElementById("stickyCalcBar");
  const stickyBtn = document.getElementById("stickyCalculateBtn");

  if (!mainBtn || !stickyBar) return;

  function check() {
    const rect = mainBtn.getBoundingClientRect();

    // If button is out of view → show sticky version
    if (rect.bottom < 0 || rect.top > window.innerHeight) {
      stickyBar.style.display = "block";
    } else {
      stickyBar.style.display = "none";
    }
  }

  // Scroll listening
  window.addEventListener("scroll", check);
  window.addEventListener("resize", check);

  // Sticky button triggers calculation
  stickyBtn.addEventListener("click", () => {
    mainBtn.click();
  });

  check(); // initial check
}

window.addEventListener("load", watchCalculateButton);


</script>


</body>
</html>
