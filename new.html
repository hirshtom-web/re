<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Real Estate Calculators</title>

  <!-- MATERIAL ICONS OUTLINED -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

 <style>
/* ===================== */
/* BASE STYLES           */
/* ===================== */
html, body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    margin: 0;
    padding: 0;
    color: #1e0949;
    touch-action: manipulation; /* prevents unintended zooming/panning */
    overscroll-behavior: none;  /* prevents jumping on mobile */
    -webkit-text-size-adjust: 100%; /* disable font zoom on iOS */
}

body {
    padding: 40px;
}

h1 {
    color: #1e0949;
    margin-bottom: 10px;
}

h2.category-title {
    color: #1e0949;
    font-size: 20px;
    border-left: 4px solid #3498db;
    padding-left: 10px;
}

h2 { 
    text-align: left; 
    font-size: 30px; 
    font-weight: 700; 
    margin-bottom: 0px; 
}

h3 { 
    text-align: left; 
    font-size: 15px; 
    font-weight: 500; 
    margin-bottom: 45px; 
}

h4 { 
    text-align: left; 
    font-size: 15px; 
    font-weight: 500; 
    margin-bottom: 15px; 
}

.info {
    font-size: 10px;
    color: #555;
    cursor: help;
    margin-left: 4px;
}

label { 
    font-weight: 500; 
    margin-bottom: 6px; 
    font-size: 12px; 
}

/* ===================== */
/* BUTTON & INPUT STYLES */
/* ===================== */

input, select, textarea {
    width: 100%;                /* consistent width */
    padding: 12px 15px;         /* spacing inside input */
    font-size: 15px;            /* readable text */
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: #1e0949;             /* text color */
    background-color: #fff;     /* white background */
    border: 1px solid #ddd;     /* subtle border */
    border-radius: 8px;         /* rounded corners */
    box-sizing: border-box;     /* include padding in width */
    line-height: 20px;
    transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus, select:focus, textarea:focus {
    border-color: #005bff;      /* highlight on focus */
    box-shadow: 0 0 5px rgba(0,91,255,0.2);
    outline: none;
}

input[disabled], select[disabled], textarea[disabled] {
    background-color: #f0f0f0;
    color: #aaa;
    cursor: not-allowed;
}

select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14'><polygon points='0,0 14,0 7,7' fill='%23999'/></svg>");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 12px;
    cursor: pointer;
}

.calc-btn {
    width: 100%;
    padding: 14px;
    margin-top: 40px;
    font-size: 15px;
    background: #005bff;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
}

.calc-btn:hover { 
    background: #003f9a; 
}

/* ===================== */
/* TILE / CARD LAYOUT    */
/* ===================== */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 16px;
    margin-top: 15px;
}

.tile {
    background: white;
    border-radius: 12px;
    box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    padding: 18px;
    cursor: pointer;
    transition: all 0.25s;
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 12px;
    position: relative;
}

.tile:hover {
    transform: translateY(-4px);
    box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
}

.tile.active {
    border: 2px solid #005bff;
    box-shadow: 0px 6px 16px rgba(0, 125, 255, 0.25);
}

.tile:active {
    transform: scale(0.97);
}

.tile .material-icons-outlined {
    font-size: 32px;
    color: #005bff;
}

/* ===================== */
/* CONTAINERS & LAYOUT   */
/* ===================== */
.container {
    display: flex;
    flex-wrap: wrap;       
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
    align-items: flex-start;
    box-sizing: border-box;
}

.inputs-container,
.results-container {
    background: #fff;
    border-radius: 45px;
    padding: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
}

.inputs-container { flex: 1 1 400px; min-width: 350px; }
.results-container { flex: 1 1 350px; min-width: 300px; }

/* 50/50 Desktop layout */
@media (min-width: 901px) {
    .inputs-container,
    .results-container {
        flex: 1 1 calc(50% - 20px);
    }
}

/* ===================== */
/* GRID LAYOUTS          */
/* ===================== */
.roi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 18px;
    margin-bottom: 20px;
}

.input-group { display: flex; flex-direction: column; }
   

.roi-columns {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: space-between;
    width: 100%;
    box-sizing: border-box;
}

.roi-column {
    flex: 1 1 0;
    min-width: 0;
    text-align: center;
}

   .grid-name {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 4px;
  color: #000;
}


/* ===================== */
/* RESULTS DISPLAY       */
/* ===================== */
.total-roi-display {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 25px;
    height: 120px;
}

.total-roi-display span {
    font-size: 80px;
    font-weight: 800;
    color: #005bff;
}

.result-card .label { 
    font-weight: 500; 
    margin-bottom: 6px; 
    font-size: 12px; 
    color: #555; 
}

.result-card .value { 
    font-weight: 500; 
    font-size: 12px; 
    color: #1e0949; 
    margin-bottom: 16px; 
}

   #mainResult {
    font-size: 100px;
    font-weight: 800;
    color: #005bff;
    display: block;
}

@keyframes countUp {
    from { opacity: 0.2; }
    to { opacity: 1; }
}


/* ===================== */
/* EXPENSES & DOWNLOAD   */
/* ===================== */
.added-expense { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
.added-expense select, .added-expense input { flex: 1; }
.remove-btn { background: #ff4d4f; color: white; border: none; border-radius: 6px; padding: 0 8px; cursor: pointer; }

.download-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    padding: 15px;
    border-top: 1px solid #ddd;
    width: 100%;
    box-sizing: border-box;
}

.download-text {
    flex: 1 1 0;
    min-width: 0; 
    font-size: 14px;
    color: #555;
}

.download-btn { white-space: nowrap; }

/* ===================== */
/* TAB NAVIGATION        */
/* ===================== */
.tab-container {
    width: 100%;
    display: flex;
    border-bottom: 1px solid #ddd;
    margin-bottom: 25px;
    overflow-x: auto;
}

.tab {
    flex: 1;
    text-align: center;
    padding: 14px 22px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    background: #f7f8fa;
    border: 1px solid #ddd;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    transition: background 0.2s, color 0.2s;
}

.tab-icon { width: 18px; height: 18px; opacity: 0.65; transition: opacity 0.2s; }

.tab.active {
    background: #fff;
    color: #005bff;
    border-bottom: 0;
}

.tab.active .tab-icon { opacity: 1; }

.tab-content { display: none; animation: fadeIn 0.25s ease; }
.tab-content.active { display: block; }
 
   .tab-contents {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
}


@keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
}

.disabled { background-color: #ccc !important; color: #888 !important; cursor: not-allowed !important; }
.value.disabled { color: #aaa !important; }

/* ===================== */
/* DISCLAIMER BOX         */
/* ===================== */
.disclaimer-box {
    margin-top: 25px;
    padding: 15px;
    background: #f7f8fa;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 13px;
    color: #555;
}

.disclaimer-check {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    line-height: 1.4;
}

.disclaimer-check input {
    margin-top: 2px;
    transform: scale(1.2);
    cursor: pointer;
}

/* ===================== */
/* STATS BLOCK           */
/* ===================== */
.stats-fullwidth {
    width: 100%;
    max-width: 1200px;
    margin: 10px auto 0;
    padding: 30px;
    background: #fff;
    border-radius: 45px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    box-sizing: border-box;
}

.stats-title {
    font-size: 18px;
    margin-bottom: 25px;
    font-weight: 600;
    color: #1e0949;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
}

.stat-box {
    border: 0.5px solid #ddd;
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    background: #fafbfc;
}

.stat-label {
    font-size: 12px;
    color: #666;
    font-weight: 500;
    margin-bottom: 6px;
}

.stat-value {
    font-size: 16px;
    font-weight: 700;
    color: #1e0949;
}

/* ===================== */
/* SUGGESTIONS DROPDOWN  */
/* ===================== */
.suggestions-box {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    z-index: 1000;
    max-height: 220px;
    overflow-y: auto;
    display: none;
}

.suggestion-item {
    padding: 10px 12px;
    font-size: 14px;
    cursor: pointer;
    border-bottom: 1px solid #f1f1f1;
}

.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover { background: #f4f0ff; color: #6327e5; }

/* ===================== */
/* RESPONSIVE / MOBILE    */
/* ===================== */
@media (max-width: 900px) {
    body { padding: 0; }
    .container { flex-direction: column; gap: 20px; width: 100%; padding: 0 20px; }
    .inputs-container, .results-container { width: 100%; padding: 20px; border-radius: 30px; }
    .roi-grid { grid-template-columns: 1fr; gap: 12px; }
    .total-roi-display span { font-size: 50px; }
    .calc-btn { font-size: 15px; }
}

@media (max-width: 600px) {
    .roi-columns { flex-direction: column !important; gap: 12px !important; }
    .roi-column { flex: 1 1 100% !important; text-align: center; }
    .tab { font-size: 0 !important; gap: 0 !important; justify-content: center !important; flex: 1 1 100%; }
    .tab-icon { width: 18px; height: 18px; opacity: 0.9; }
    .download-container { flex-direction: column !important; align-items: stretch !important; gap: 10px; }
    .download-btn { width: 100% !important; }
    .download-text { text-align: center; }
    .tab-contents { grid-template-columns: 1fr; }
}

@media (max-width: 500px) {
    .stats-grid { grid-template-columns: 1fr; }
}


</style>

  
</head>
<body>
<!-- SCREEN 1: GRID -->
<div id="screenGrid">
  <h1>Select a Calculator</h1>

  <h2 class="category-title">Financing</h2>
  <div class="grid" id="cat-financing"></div>

  <h2 class="category-title">Returns</h2>
  <div class="grid" id="cat-returns"></div>

  <h2 class="category-title">Valuation</h2>
  <div class="grid" id="cat-valuation"></div>

  <h2 class="category-title">Analysis & Metrics</h2>
  <div class="grid" id="cat-analysis"></div>
</div>


<!-- SCREEN 2: CALCULATOR VIEW -->
<div id="screenCalculator" style="display:none;">

  <!-- Page Title: Centered at the top of the page -->
  <h1 id="pageTitle" style="text-align:center;">Page Title</h1>

  <!-- Main Container: inputs + results -->
  <div class="container">

    <!-- Inputs Section -->
    <div class="inputs-container">
      
      <!-- Calculator Title: h2 top-left -->
      <h2 id="calculatorTitle">Calculator Title</h2>
      
      <!-- Subtitle: h3 under calculatorTitle -->
      <h3 id="subtitle">Subtitle goes here</h3>
      
      <!-- Form -->
      <form id="calculatorForm">
        <!-- Input fields will go here -->
      </form>
    </div>

    <!-- Results Section -->
<div class="results-container">
  <!-- Results Header -->
  <h3>Results</h3>

  <!-- Main Result Display -->
  <div class="total-roi-display">
    <span id="mainResult">$0</span>
  </div>

  <!-- Stats Section -->
  <div id="resultStats" class="stats-grid"></div>
</div>


  <!-- Back Button -->
  <button id="backBtn" class="back-button">
    <span class="material-icons-outlined">arrow_back</span> Back
  </button>

</div>

 

  </div>
</div>


<script>

  
  /* --------- CALCULATOR DEFINITIONS ----------- */

 const calculators = {
  cashFlow: {
    CalculatorName: "Cash Flow Calculator",
    gridName: "Cash Flow",
    pageTitle: "Cash Flow Calculator",
    calculatorTitle: "Visualize your propertyâ€™s cash flow instantly.",
    subtitle: "See monthly income and expenses to understand your net cash position.",
    tabs: { "Income": { inputs: ["Income"] }, "Expenses": { inputs: ["Expenses"] }, "Financing": { inputs: ["Mortgage Payment"] } },
    cat: "analysis",
    icon: "payments",
    tooltip: "Calculates monthly or annual cash flow after all expenses.",
    calculate: (Income, Expenses, MortgagePayment) => Income - Expenses - MortgagePayment
  },
  cashOnCash: {
    CalculatorName: "Cash-on-Cash ROI Calculator",
    gridName: "Cash-on-Cash",
    pageTitle: "Cash-on-Cash ROI Calculator",
    calculatorTitle: "Measure your cash-on-cash returns with ease.",
    subtitle: "Compare your investment vs. actual cash profit to make informed decisions.",
    tabs: { "Key Details": { inputs: ["Annual Cash Flow", "Total Cash Invested"] } },
    cat: "returns",
    icon: "percent",
    tooltip: "Shows annual ROI on actual cash invested.",
    calculate: (CF, Invested) => ((CF / Invested) * 100).toFixed(2) + "%"
  },
  capRate: {
    CalculatorName: "Cap Rate Calculator",
    gridName: "Cap Rate",
    pageTitle: "Cap Rate Calculator",
    calculatorTitle: "Assess the profitability of your property quickly.",
    subtitle: "Evaluate annual returns relative to property value for smarter investing.",
    tabs: { "Key Details": { inputs: ["Net Operating Income", "Property Value"] } },
    cat: "valuation",
    icon: "speed",
    tooltip: "Valuation measure ignoring financingâ€”NOI Ã· property value.",
    calculate: (NOI, PV) => ((NOI / PV) * 100).toFixed(2) + "%"
  },
  grm: {
    CalculatorName: "Gross Rent Multiplier Calculator",
    gridName: "GRM",
    pageTitle: "Gross Rent Multiplier Calculator",
    calculatorTitle: "Understand your propertyâ€™s rent potential at a glance.",
    subtitle: "Estimate Gross Rent Multiplier to compare multiple investment opportunities.",
    tabs: { "Key Details": { inputs: ["Property Price", "Annual Rent"] } },
    cat: "valuation",
    icon: "calculate",
    tooltip: "Price divided by annual rent. Lower GRM is better.",
    calculate: (Price, Rent) => (Price / Rent).toFixed(2)
  },
  mortgage: {
    CalculatorName: "Mortgage Payment Calculator",
    gridName: "Mortgage",
    pageTitle: "Mortgage Payment Calculator",
    calculatorTitle: "Calculate your mortgage payments effortlessly.",
    subtitle: "Determine monthly principal and interest to plan your financing strategy.",
    tabs: { "Financing": { inputs: ["Loan Amount", "Interest Rate (%)", "Loan Term (years)"] } },
    cat: "financing",
    icon: "account_balance",
    tooltip: "Monthly loan payment based on rate & term.",
    calculate: (Loan, Rate, Term) => {
      const r = Rate / 100 / 12;
      const n = Term * 12;
      return (Loan * r / (1 - Math.pow(1 + r, -n))).toFixed(2);
    }
  },
  breakEven: {
    CalculatorName: "Break-even Analysis Calculator",
    gridName: "Break-even",
    pageTitle: "Break-even Analysis Calculator",
    calculatorTitle: "Find your break-even point quickly.",
    subtitle: "Discover how many units or revenue you need to cover all costs.",
    tabs: { "Expenses": { inputs: ["Fixed Costs", "Variable Costs per Unit"] }, "Income": { inputs: ["Revenue per Unit"] } },
    cat: "analysis",
    icon: "bar_chart",
    tooltip: "Units needed to cover all expenses.",
    calculate: (Fixed, Variable, Revenue) => (Fixed / (Revenue - Variable)).toFixed(2)
  },
  roi: {
    CalculatorName: "ROI Calculator",
    gridName: "ROI",
    pageTitle: "Return on Investment Calculator",
    calculatorTitle: "Calculate your overall return on investment.",
    subtitle: "Combine purchase, financing, income, and expenses for a complete ROI picture.",
    tabs: {
      "Key Details": {
        inputs: [
          "Purchase Price ($)",
          "Appreciation Rate (%)",
          "Years to Hold",
          "Property Type",
          "Market (City & State)"
        ]
      },
      "Financing": {
        inputs: [
          "Down Payment (%)",
          "Cash Investment ($)",
          "Financed Amount ($)",
          "Mortgage Rate (%)",
          "Mortgage Term (Years)"
        ]
      },
      "Income": {
        inputs: ["Monthly Rent ($)"]
      },
      "Expenses": {
        inputs: [
          "Property Taxes ($/yr)",
          "Homeownerâ€™s Insurance ($/yr)",
          "HOA ($/mo)",
          "Management Fees (%)",
          "Vacancy Rate (%)"
        ]
      }
    },
    cat: "returns",
    icon: "trending_up",
    tooltip: "ROI calculation including purchase, financing, income, and expenses.",
    calculate: function(values) {
      const investment = parseFloat(values["Cash Investment ($)"] || 0);
      const netProfit = parseFloat(values["Monthly Rent ($)"] || 0) * 12 * parseFloat(values["Years to Hold"] || 1) 
                        - parseFloat(values["Property Taxes ($/yr)"] || 0)
                        - parseFloat(values["Homeownerâ€™s Insurance ($/yr)"] || 0)
                        - parseFloat(values["HOA ($/mo)"] || 0) * 12;
      return investment ? ((netProfit / investment) * 100).toFixed(2) + "%" : "N/A";
    }
  },
  noi: {
    CalculatorName: "Net Operating Income Calculator",
    gridName: "NOI",
    pageTitle: "Net Operating Income Calculator",
    calculatorTitle: "Determine Net Operating Income for your property.",
    subtitle: "Subtract operating expenses from income to see what the property really earns.",
    tabs: { "Income": { inputs: ["Gross Income"] }, "Expenses": { inputs: ["Operating Expenses"] } },
    cat: "analysis",
    icon: "account_balance_wallet",
    tooltip: "Income minus operating expenses.",
    calculate: (GI, OE) => GI - OE
  },
  dscr: {
    CalculatorName: "Debt Service Coverage Ratio Calculator",
    gridName: "DSCR",
    pageTitle: "Debt Service Coverage Ratio Calculator",
    calculatorTitle: "Check your debt service coverage ratio.",
    subtitle: "Measure your propertyâ€™s ability to cover debt with its net operating income.",
    tabs: { "Income": { inputs: ["NOI"] }, "Financing": { inputs: ["Debt Service"] } },
    cat: "financing",
    icon: "shield",
    tooltip: "NOI Ã· debt service â€” lenders want 1.2+.",
    calculate: (NOI, Debt) => (NOI / Debt).toFixed(2)
  },
  priceToRent: {
    CalculatorName: "Price-to-Rent Ratio Calculator",
    gridName: "Price-to-Rent",
    pageTitle: "Price-to-Rent Ratio Calculator",
    calculatorTitle: "Analyze the price-to-rent ratio of your property.",
    subtitle: "Compare property value to rental income to spot lucrative deals.",
    tabs: { "Key Details": { inputs: ["Property Price", "Annual Rent"] } },
    cat: "valuation",
    icon: "home",
    tooltip: "Home price compared to rental income.",
    calculate: (Price, Rent) => (Price / Rent).toFixed(2)
  },
  vacancy: {
    CalculatorName: "Vacancy Rate Calculator",
    gridName: "Vacancy",
    pageTitle: "Vacancy Rate Calculator",
    calculatorTitle: "Estimate losses from vacancy periods.",
    subtitle: "Understand potential revenue gaps to make more realistic forecasts.",
    tabs: { "Income": { inputs: ["Vacant Units", "Total Units"] } },
    cat: "analysis",
    icon: "hotel",
    tooltip: "Vacant units Ã· total units.",
    calculate: (Vacant, Total) => ((Vacant / Total) * 100).toFixed(2) + "%"
  },
  expenseRatio: {
    CalculatorName: "Operating Expense Ratio Calculator",
    gridName: "Expense Ratio",
    pageTitle: "Operating Expense Ratio Calculator",
    calculatorTitle: "Track your operating expense ratio accurately.",
    subtitle: "See how much of your income goes toward expenses for better planning.",
    tabs: { "Income": { inputs: ["Gross Income"] }, "Expenses": { inputs: ["Operating Expenses"] } },
    cat: "analysis",
    icon: "receipt_long",
    tooltip: "Expenses Ã· income â€” lower is better.",
    calculate: (Income, Expenses) => ((Expenses / Income) * 100).toFixed(2) + "%"
  },
  longTermROI: {
    CalculatorName: "Long-Term ROI Calculator",
    gridName: "Long-Term ROI",
    pageTitle: "Long-Term ROI Calculator",
    calculatorTitle: "Forecast your long-term returns from rent and appreciation.",
    subtitle: "Combine cash flow and property value growth for a complete investment outlook.",
    tabs: { "Income": { inputs: ["Rental Income", "Property Appreciation"] }, "Key Details": { inputs: ["Investment Cost"] } },
    cat: "returns",
    icon: "timeline",
    tooltip: "Total rent + appreciation returns.",
    calculate: (Rent, App, Cost) => (((Rent + App) / Cost) * 100).toFixed(2) + "%"
  },
  flip: {
    CalculatorName: "Fix & Flip Profit Calculator",
    gridName: "Fix & Flip",
    pageTitle: "Fix & Flip Profit Calculator",
    calculatorTitle: "Project profits from your fix & flip projects.",
    subtitle: "Calculate renovation costs, resale value, and potential ROI in one view.",
    tabs: { "Key Details": { inputs: ["Sale Price", "Purchase Price", "Renovation Costs"] } },
    cat: "returns",
    icon: "construction",
    tooltip: "Sale price minus purchase & renovation costs.",
    calculate: (Sale, Purchase, Reno) => Sale - Purchase - Reno
  },
  renovationROI: {
    CalculatorName: "Renovation ROI Calculator",
    gridName: "Renovation ROI",
    pageTitle: "Renovation ROI Calculator",
    calculatorTitle: "Measure ROI from property improvements.",
    subtitle: "See how each renovation affects your investmentâ€™s profitability.",
    tabs: { "Key Details": { inputs: ["Profit from Renovation", "Renovation Cost"] } },
    cat: "returns",
    icon: "build",
    tooltip: "Return generated from renovation expenditures.",
    calculate: (Profit, Cost) => ((Profit / Cost) * 100).toFixed(2) + "%"
  },
  taxDepreciation: {
    CalculatorName: "Tax / Depreciation Impact Calculator",
    gridName: "Tax / Depreciation",
    pageTitle: "Tax / Depreciation Impact Calculator",
    calculatorTitle: "Estimate tax impacts and depreciation benefits.",
    subtitle: "Plan for deductions and understand their effect on net returns.",
    tabs: { "Income": { inputs: ["Taxable Income"] }, "Expenses": { inputs: ["Depreciation"] } },
    cat: "analysis",
    icon: "receipt",
    tooltip: "Taxable income minus depreciation benefits.",
    calculate: (Inc, Dep) => Inc - Dep
  },
  cma: {
    CalculatorName: "Comparative Market Analysis Calculator",
    gridName: "CMA",
    pageTitle: "Comparative Market Analysis Calculator",
    calculatorTitle: "Perform a comparative market analysis easily.",
    subtitle: "Compare properties to determine fair market value and pricing strategy.",
    tabs: { "Key Details": { inputs: ["Market Value", "Property Value"] } },
    cat: "valuation",
    icon: "analytics",
    tooltip: "Property value vs market value.",
    calculate: (M, P) => ((M / P) * 100).toFixed(2) + "%"
  },
  leverageROI: {
    CalculatorName: "Leverage ROI Calculator",
    gridName: "Leverage ROI",
    pageTitle: "Leverage ROI Calculator",
    calculatorTitle: "Evaluate leveraged returns with financing.",
    subtitle: "See how loans amplify your ROI and understand associated risks.",
    tabs: { "Income": { inputs: ["Cash Flow"] }, "Key Details": { inputs: ["Equity Invested"] } },
    cat: "returns",
    icon: "trending_up",
    tooltip: "Return based on leveraged equity invested.",
    calculate: (CF, EQ) => ((CF / EQ) * 100).toFixed(2) + "%"
  }
};


/* ----------------------------------------------------
   FORMAT INPUT WITH COMMAS + STORE CLEAN RAW NUMBERS
---------------------------------------------------- */
function formatInputWithCommas(input, inputValues, key) {
  input.addEventListener("input", () => {
    let raw = input.value.replace(/,/g, "");

    // Accept numbers only
    if (!/^\d*\.?\d*$/.test(raw)) return;

    inputValues[key] = raw; // save clean number (no commas)

    if (raw === "") {
      input.value = "";
      return;
    }

    // Format for display
    const parts = raw.split(".");
    parts[0] = Number(parts[0]).toLocaleString();
    input.value = parts.join(".");
  });
}


/* ----------------------------------------------------
   ðŸ”¥ ADDED: SHORTEN BIG NUMBERS (B, M, K)
---------------------------------------------------- */
function shortenBigNumber(num) {
  num = Number(num);
  if (num >= 1_000_000_000) return (num / 1_000_000_000).toFixed(2) + "B";
  if (num >= 1_000_000)     return (num / 1_000_000).toFixed(2) + "M";
  if (num >= 1000)          return num.toLocaleString();
  return num.toString();
}


/* ------------------ CATEGORY CONTAINERS ------------------ */
const categories = {
  financing: document.getElementById("cat-financing"),
  returns: document.getElementById("cat-returns"),
  valuation: document.getElementById("cat-valuation"),
  analysis: document.getElementById("cat-analysis")
};

/* ------------------ RENDER TILES ------------------ */
Object.entries(calculators).forEach(([key, c]) => {
  const tile = document.createElement("div");
  tile.className = "tile";
  tile.dataset.tooltip = c.tooltip;

  tile.innerHTML = `
    <span class="material-icons-outlined">${c.icon}</span>
    <div>
      <div class="grid-name">${c.gridName}</div>
      <div>${c.calculatorTitle}</div>
    </div>
  `;

  tile.onclick = () => {
    loadCalculator(key);
    window.location.hash = key;
  };

  categories[c.cat].appendChild(tile);
});

  /* --------- TOP US CITIES FOR AUTOCOMPLETE --------- */
const topCities = [
  "New York, NY","Los Angeles, CA","Chicago, IL","Houston, TX","Phoenix, AZ",
  "Philadelphia, PA","San Antonio, TX","San Diego, CA","Dallas, TX","San Jose, CA",
  "Austin, TX","Jacksonville, FL","Fort Worth, TX","Columbus, OH","Charlotte, NC",
  "San Francisco, CA","Indianapolis, IN","Seattle, WA","Denver, CO","Washington, DC",
  "Boston, MA","El Paso, TX","Nashville, TN","Detroit, MI","Oklahoma City, OK",
  "Portland, OR","Las Vegas, NV","Memphis, TN","Louisville, KY","Baltimore, MD",
  "Milwaukee, WI","Albuquerque, NM","Tucson, AZ","Fresno, CA","Sacramento, CA",
  "Kansas City, MO","Long Beach, CA","Mesa, AZ","Atlanta, GA","Colorado Springs, CO",
  "Virginia Beach, VA","Raleigh, NC","Omaha, NE","Miami, FL","Oakland, CA",
  "Minneapolis, MN","Tulsa, OK","Wichita, KS","New Orleans, LA","Arlington, TX"
  // ...add more cities if needed
];

  /* ------------------ AUTOCOMPLETE FUNCTION ------------------ */
function autocomplete(inp, arr) {
  let currentFocus;

  inp.addEventListener("input", function() {
    let val = this.value;
    closeAllLists();
    if (!val) return false;
    currentFocus = -1;

    const listDiv = document.createElement("DIV");
    listDiv.setAttribute("id", this.id + "-autocomplete-list");
    listDiv.setAttribute("class", "autocomplete-items");
    listDiv.style.border = "1px solid #ccc";
    listDiv.style.borderTop = "none";
    listDiv.style.position = "absolute";
    listDiv.style.backgroundColor = "#fff";
    listDiv.style.zIndex = "99";
    listDiv.style.maxHeight = "200px";
    listDiv.style.overflowY = "auto";
    this.parentNode.appendChild(listDiv);

    arr.forEach(city => {
      if (city.toLowerCase().includes(val.toLowerCase())) {
        const item = document.createElement("DIV");
        item.innerHTML = city.replace(new RegExp(val, "i"), match => `<strong>${match}</strong>`);
        item.style.padding = "5px";
        item.style.cursor = "pointer";
        item.addEventListener("click", function() {
          inp.value = city;
          closeAllLists();
        });
        listDiv.appendChild(item);
      }
    });
  });

  inp.addEventListener("keydown", function(e) {
    let x = document.getElementById(this.id + "-autocomplete-list");
    if (x) x = x.getElementsByTagName("div");
    if (e.keyCode == 40) { currentFocus++; addActive(x); } // down
    else if (e.keyCode == 38) { currentFocus--; addActive(x); } // up
    else if (e.keyCode == 13) { e.preventDefault(); if (currentFocus > -1 && x) x[currentFocus].click(); } // enter
  });

  function addActive(x) {
    if (!x) return false;
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = x.length - 1;
    x[currentFocus].classList.add("autocomplete-active");
    x[currentFocus].style.backgroundColor = "#e9e9e9";
  }

  function removeActive(x) {
    for (let i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
      x[i].style.backgroundColor = "#fff";
    }
  }

  function closeAllLists(elmnt) {
    const x = document.getElementsByClassName("autocomplete-items");
    for (let i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) x[i].parentNode.removeChild(x[i]);
    }
  }

  document.addEventListener("click", function (e) {
    closeAllLists(e.target);
  });
}

  /* ------------------ AUTO-DETECT LOCATION ------------------ */
function autoDetectLocation(inputEl) {
  fetch("https://ipapi.co/json/")
    .then(res => res.json())
    .then(data => {
      let city = data.city || "";
      let state = data.region || "";
      if (city || state) {
        inputEl.value = `${city}${city && state ? ", " : ""}${state}`;
        inputEl.dispatchEvent(new Event("input")); // triggers autocomplete
      }
    })
    .catch(err => console.warn("Location lookup failed:", err));
}

/* ------------------ COMMON ELEMENTS ------------------ */
const allTiles = document.getElementsByClassName("tile");
const titleEl = document.getElementById("calculatorTitle");
const form = document.getElementById("calculatorForm");
const resultEl = document.getElementById("mainResult");

/* ------------------ LOAD CALCULATOR ------------------ */
function loadCalculator(key) {
  if (!calculators[key]) return;

  const calc = calculators[key];

  document.getElementById("screenGrid").style.display = "none";
  document.getElementById("screenCalculator").style.display = "block";

  [...allTiles].forEach((t, i) =>
    t.classList.toggle("active", Object.keys(calculators)[i] === key)
  );

  document.getElementById("pageTitle").textContent = calc.pageTitle;
  titleEl.textContent = calc.calculatorTitle;
  document.getElementById("subtitle").textContent = calc.subtitle;

  form.innerHTML = "";
  resultEl.textContent = "";

  const inputValues = {};

  /* ------------------ OPTIONAL LOCATION ------------------ */
  if (calc.location) {
    const loc = document.createElement("input");
    loc.type = "text";
    loc.placeholder = "City, State";
    loc.oninput = () => inputValues["location"] = loc.value;
    form.appendChild(loc);
  }

  /* ------------------ TABS ------------------ */
  const tabContainer = document.createElement("div");
  tabContainer.className = "tab-container";
  form.appendChild(tabContainer);

  const tabContents = document.createElement("div");
  tabContents.className = "tab-contents";
  form.appendChild(tabContents);

  const preferredOrder = ["Key Details", "Financing", "Income", "Expenses"];
  const tabNames = preferredOrder.filter(t => calc.tabs[t])
    .concat(Object.keys(calc.tabs).filter(t => !preferredOrder.includes(t)));

  let activeTab = tabNames[0];

  function renderTabInputs(tab) {
    tabContents.innerHTML = "";
    activeTab = tab;

    calc.tabs[tab].inputs.forEach(name => {
      const group = document.createElement("div");
      group.className = "input-group";

      const label = document.createElement("label");
      label.textContent = name;

      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = name;

      if (inputValues[name]) {
        const raw = inputValues[name];
        const parts = raw.toString().split(".");
        parts[0] = Number(parts[0]).toLocaleString();
        input.value = parts.join(".");
      }

      formatInputWithCommas(input, inputValues, name);

      group.appendChild(label);
      group.appendChild(input);
      tabContents.appendChild(group);
    });
  }

  tabNames.forEach(tab => {
    const btn = document.createElement("div");
    btn.className = "tab";
    btn.textContent = tab;

    if (tab === activeTab) btn.classList.add("active");

    btn.onclick = () => {
      [...tabContainer.children].forEach(t => t.classList.remove("active"));
      btn.classList.add("active");
      renderTabInputs(tab);
    };

    tabContainer.appendChild(btn);
  });

  renderTabInputs(activeTab);

  /* ------------------ CALCULATE BUTTON ------------------ */
  const button = document.createElement("button");
  button.className = "calc-btn";
  button.textContent = "Calculate";

  button.onclick = (e) => {
    e.preventDefault();

    const values = calc.tabs[activeTab].inputs.map(id => {
      const val = inputValues[id];
      return val !== undefined ? Number(val.replace(/,/g, "")) : NaN;
    });

    const locationValue = calc.location ? inputValues["location"] : null;

    if (values.some(v => isNaN(v))) {
      // ðŸ”¥ ADDED â€” error uses H3
      resultEl.innerHTML = "<h3>Please fill all inputs!</h3>";
      return;
    }

    let raw = calc.calculate(...values, locationValue);

    /* ----------------------------------------------------
       ðŸ”¥ REPLACED RESULT HANDLING COMPLETELY
    ---------------------------------------------------- */

    // Percent (string like "8.3%")
    if (typeof raw === "string" && raw.includes("%")) {
      resultEl.textContent = parseFloat(raw).toFixed(2) + "%";
      return;
    }

    let num = Number(raw);

    // shorten if more than 9 digits
    const digitCount = Math.floor(Math.log10(Math.abs(num))) + 1;

    if (digitCount > 9) {
      resultEl.textContent = shortenBigNumber(num);
    } else {
      resultEl.textContent = num.toLocaleString();
    }
  };

  form.appendChild(button);
}

/* ------------------ BACK BUTTON ------------------ */
document.getElementById("backBtn").onclick = () => {
  document.getElementById("screenCalculator").style.display = "none";
  document.getElementById("screenGrid").style.display = "block";
  resultEl.textContent = "";
  window.location.hash = "";
};

/* ------------------ HASH LOADING ------------------ */
function tryLoadFromHash() {
  const h = window.location.hash.replace("#", "");
  if (h && calculators[h]) loadCalculator(h);
}

window.addEventListener("load", tryLoadFromHash);
window.addEventListener("hashchange", tryLoadFromHash);


</script>



</body>
</html>
