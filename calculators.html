<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Real Estate Calculators</title>

  <!-- MATERIAL ICONS OUTLINED -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

 <style>
/* ===================== */
/* BASE STYLES           */
/* ===================== */
html, body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    margin: 0;
    padding: 0;
    color: #1e0949;
    touch-action: manipulation; /* prevents unintended zooming/panning */
    overscroll-behavior: none;  /* prevents jumping on mobile */
    -webkit-text-size-adjust: 100%; /* disable font zoom on iOS */
}

body {
    padding: 40px;
}

h1 {
    color: #1e0949;
    margin-bottom: 10px;
}

h2.category-title {
    color: #1e0949;
    font-size: 20px;
    border-left: 4px solid #3498db;
    padding-left: 10px;
}

h2 { 
    text-align: left; 
    font-size: 30px; 
    font-weight: 700; 
    margin-bottom: 0px; 
}

h3 { 
    text-align: left; 
    font-size: 15px; 
    font-weight: 500; 
    margin-bottom: 45px; 
}

h4 { 
    text-align: left; 
    font-size: 15px; 
    font-weight: 500; 
    margin-bottom: 15px; 
}

.info {
    font-size: 10px;
    color: #555;
    cursor: help;
    margin-left: 4px;
}

label { 
    font-weight: 500; 
    margin-bottom: 6px; 
    font-size: 12px; 
}

/* ===================== */
/* BUTTON & INPUT STYLES */
/* ===================== */
/* ===================== */
/* UNIFIED INPUT STYLES  */
/* ===================== */
input, select, textarea {
    width: 100%;                /* consistent width */
    padding: 12px 15px;         /* spacing inside input */
    font-size: 15px;            /* readable text */
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: #1e0949;             /* text color */
    background-color: #fff;     /* white background */
    border: 1px solid #ddd;     /* subtle border */
    border-radius: 8px;         /* rounded corners */
    box-sizing: border-box;     /* include padding in width */
    line-height: 20px;
    transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus, select:focus, textarea:focus {
    border-color: #005bff;      /* highlight on focus */
    box-shadow: 0 0 5px rgba(0,91,255,0.2);
    outline: none;
}

input[disabled], select[disabled], textarea[disabled] {
    background-color: #f0f0f0;
    color: #aaa;
    cursor: not-allowed;
}

select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14'><polygon points='0,0 14,0 7,7' fill='%23999'/></svg>");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 12px;
    cursor: pointer;
}

.calc-btn {
    width: 100%;
    padding: 14px;
    margin-top: 10px;
    font-size: 17px;
    background: #005bff;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
}

.calc-btn:hover { 
    background: #003f9a; 
}

/* ===================== */
/* TILE / CARD LAYOUT    */
/* ===================== */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 16px;
    margin-top: 15px;
}

.tile {
    background: white;
    border-radius: 12px;
    box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
    padding: 18px;
    cursor: pointer;
    transition: all 0.25s;
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 12px;
    position: relative;
}

.tile:hover {
    transform: translateY(-4px);
    box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
}

.tile.active {
    border: 2px solid #005bff;
    box-shadow: 0px 6px 16px rgba(0, 125, 255, 0.25);
}

.tile:active {
    transform: scale(0.97);
}

.tile .material-icons-outlined {
    font-size: 32px;
    color: #005bff;
}

/* ===================== */
/* CONTAINERS & LAYOUT   */
/* ===================== */
.container {
    display: flex;
    flex-wrap: wrap;       
    gap: 40px;
    max-width: 1200px;
    margin: 0 auto;
    align-items: flex-start;
    box-sizing: border-box;
}

.inputs-container,
.results-container {
    background: #fff;
    border-radius: 45px;
    padding: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
}

.inputs-container { flex: 1 1 400px; min-width: 350px; }
.results-container { flex: 1 1 350px; min-width: 300px; }

/* 50/50 Desktop layout */
@media (min-width: 901px) {
    .inputs-container,
    .results-container {
        flex: 1 1 calc(50% - 20px);
    }
}

/* ===================== */
/* GRID LAYOUTS          */
/* ===================== */
.roi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 18px;
    margin-bottom: 20px;
}

.input-group { display: flex; flex-direction: column; }

.roi-columns {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: space-between;
    width: 100%;
    box-sizing: border-box;
}

.roi-column {
    flex: 1 1 0;
    min-width: 0;
    text-align: center;
}

/* ===================== */
/* RESULTS DISPLAY       */
/* ===================== */
.total-roi-display {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 25px;
    height: 120px;
}

.total-roi-display span {
    font-size: 80px;
    font-weight: 800;
    color: #005bff;
}

.result-card .label { 
    font-weight: 500; 
    margin-bottom: 6px; 
    font-size: 12px; 
    color: #555; 
}

.result-card .value { 
    font-weight: 500; 
    font-size: 12px; 
    color: #1e0949; 
    margin-bottom: 16px; 
}

/* ===================== */
/* EXPENSES & DOWNLOAD   */
/* ===================== */
.added-expense { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
.added-expense select, .added-expense input { flex: 1; }
.remove-btn { background: #ff4d4f; color: white; border: none; border-radius: 6px; padding: 0 8px; cursor: pointer; }

.download-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    padding: 15px;
    border-top: 1px solid #ddd;
    width: 100%;
    box-sizing: border-box;
}

.download-text {
    flex: 1 1 0;
    min-width: 0; 
    font-size: 14px;
    color: #555;
}

.download-btn { white-space: nowrap; }

/* ===================== */
/* TAB NAVIGATION        */
/* ===================== */
.tab-container {
    width: 100%;
    display: flex;
    border-bottom: 1px solid #ddd;
    margin-bottom: 25px;
    overflow-x: auto;
}

.tab {
    flex: 1;
    text-align: center;
    padding: 14px 22px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    background: #f7f8fa;
    border: 1px solid #ddd;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    transition: background 0.2s, color 0.2s;
}

.tab-icon { width: 18px; height: 18px; opacity: 0.65; transition: opacity 0.2s; }

.tab.active {
    background: #fff;
    color: #005bff;
    border-bottom: 0;
}

.tab.active .tab-icon { opacity: 1; }

.tab-content { display: none; animation: fadeIn 0.25s ease; }
.tab-content.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
}

.disabled { background-color: #ccc !important; color: #888 !important; cursor: not-allowed !important; }
.value.disabled { color: #aaa !important; }

/* ===================== */
/* DISCLAIMER BOX         */
/* ===================== */
.disclaimer-box {
    margin-top: 25px;
    padding: 15px;
    background: #f7f8fa;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 13px;
    color: #555;
}

.disclaimer-check {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    line-height: 1.4;
}

.disclaimer-check input {
    margin-top: 2px;
    transform: scale(1.2);
    cursor: pointer;
}

/* ===================== */
/* STATS BLOCK           */
/* ===================== */
.stats-fullwidth {
    width: 100%;
    max-width: 1200px;
    margin: 10px auto 0;
    padding: 30px;
    background: #fff;
    border-radius: 45px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    box-sizing: border-box;
}

.stats-title {
    font-size: 18px;
    margin-bottom: 25px;
    font-weight: 600;
    color: #1e0949;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
}

.stat-box {
    border: 0.5px solid #ddd;
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    background: #fafbfc;
}

.stat-label {
    font-size: 12px;
    color: #666;
    font-weight: 500;
    margin-bottom: 6px;
}

.stat-value {
    font-size: 16px;
    font-weight: 700;
    color: #1e0949;
}

/* ===================== */
/* SUGGESTIONS DROPDOWN  */
/* ===================== */
.suggestions-box {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    z-index: 1000;
    max-height: 220px;
    overflow-y: auto;
    display: none;
}

.suggestion-item {
    padding: 10px 12px;
    font-size: 14px;
    cursor: pointer;
    border-bottom: 1px solid #f1f1f1;
}

.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover { background: #f4f0ff; color: #6327e5; }

/* ===================== */
/* RESPONSIVE / MOBILE    */
/* ===================== */
@media (max-width: 900px) {
    body { padding: 0; }
    .container { flex-direction: column; gap: 20px; width: 100%; padding: 0 20px; }
    .inputs-container, .results-container { width: 100%; padding: 20px; border-radius: 30px; }
    .roi-grid { grid-template-columns: 1fr; gap: 12px; }
    .total-roi-display span { font-size: 50px; }
    .calc-btn { font-size: 15px; }
}

@media (max-width: 600px) {
    .roi-columns { flex-direction: column !important; gap: 12px !important; }
    .roi-column { flex: 1 1 100% !important; text-align: center; }
    .tab { font-size: 0 !important; gap: 0 !important; justify-content: center !important; flex: 1 1 100%; }
    .tab-icon { width: 18px; height: 18px; opacity: 0.9; }
    .download-container { flex-direction: column !important; align-items: stretch !important; gap: 10px; }
    .download-btn { width: 100% !important; }
    .download-text { text-align: center; }
}

@media (max-width: 500px) {
    .stats-grid { grid-template-columns: 1fr; }
}



</style>



  </style>
</head>
<body>
<!-- SCREEN 1: GRID -->
<div id="screenGrid">
  <h1>Select a Calculator</h1>

  <h2 class="category-title">Financing</h2>
  <div class="grid" id="cat-financing"></div>

  <h2 class="category-title">Returns</h2>
  <div class="grid" id="cat-returns"></div>

  <h2 class="category-title">Valuation</h2>
  <div class="grid" id="cat-valuation"></div>

  <h2 class="category-title">Analysis & Metrics</h2>
  <div class="grid" id="cat-analysis"></div>
</div>


<!-- SCREEN 2: CALCULATOR VIEW -->
<div id="screenCalculator" style="display:none;">

  <!-- Page Title: Centered at the top of the page -->
  <h1 id="pageTitle" style="text-align:center;">Page Title</h1>

  <!-- Main Container: inputs + results -->
  <div class="container">

    <!-- Inputs Section -->
    <div class="inputs-container">
      
      <!-- Calculator Title: h2 top-left -->
      <h2 id="calculatorTitle">Calculator Title</h2>
      
      <!-- Subtitle: h3 under calculatorTitle -->
      <h3 id="subtitle">Subtitle goes here</h3>
      
      <!-- Form -->
      <form id="calculatorForm">
        <!-- Input fields will go here -->
      </form>
    </div>

    <!-- Results Section -->
    <div class="results-container">
      
      <!-- Results Header -->
      <h3>Results</h3>
      
      <!-- Result Output -->
      <div id="result"></div>
    </div>

  </div>

  <!-- Back Button -->
  <button id="backBtn" class="back-button">
    <span class="material-icons-outlined">arrow_back</span> Back
  </button>

</div>

 

  </div>
</div>


<script>

  
  /* --------- CALCULATOR DEFINITIONS ----------- */

  const calculators = {
  cashFlow: {
    CalculatorName: "Cash Flow Calculator",
    pageTitle: "Cash Flow Calculator",
    calculatorTitle: "Cash Flow",
    subtitle: "Calculates monthly or annual cash flow after all expenses.",
    tabs: { "Income": { inputs: ["Income"] }, "Expenses": { inputs: ["Expenses"] }, "Financing": { inputs: ["Mortgage Payment"] } },
    cat: "analysis",
    icon: "payments",
    tooltip: "Calculates monthly or annual cash flow after all expenses.",
    calculate: (Income, Expenses, MortgagePayment) => Income - Expenses - MortgagePayment
  },
  cashOnCash: {
    CalculatorName: "Cash-on-Cash ROI Calculator",
    pageTitle: "Cash-on-Cash ROI Calculator",
    calculatorTitle: "Cash-on-Cash Return",
    subtitle: "Shows annual ROI on actual cash invested.",
    tabs: { "Key Details": { inputs: ["Annual Cash Flow", "Total Cash Invested"] } },
    cat: "returns",
    icon: "percent",
    tooltip: "Shows annual ROI on actual cash invested.",
    calculate: (CF, Invested) => ((CF / Invested) * 100).toFixed(2) + "%"
  },
  capRate: {
    CalculatorName: "Cap Rate Calculator",
    pageTitle: "Cap Rate Calculator",
    calculatorTitle: "Cap Rate",
    subtitle: "Valuation measure ignoring financing—NOI ÷ property value.",
    tabs: { "Key Details": { inputs: ["Net Operating Income", "Property Value"] } },
    cat: "valuation",
    icon: "speed",
    tooltip: "Valuation measure ignoring financing—NOI ÷ property value.",
    calculate: (NOI, PV) => ((NOI / PV) * 100).toFixed(2) + "%"
  },
  grm: {
    CalculatorName: "Gross Rent Multiplier Calculator",
    pageTitle: "Gross Rent Multiplier Calculator",
    calculatorTitle: "GRM",
    subtitle: "Price divided by annual rent. Lower GRM is better.",
    tabs: { "Key Details": { inputs: ["Property Price", "Annual Rent"] } },
    cat: "valuation",
    icon: "calculate",
    tooltip: "Price divided by annual rent. Lower GRM is better.",
    calculate: (Price, Rent) => (Price / Rent).toFixed(2)
  },
  mortgage: {
    CalculatorName: "Mortgage Payment Calculator",
    pageTitle: "Mortgage Payment Calculator",
    calculatorTitle: "Mortgage Payment",
    subtitle: "Monthly loan payment based on rate & term.",
    tabs: { "Financing": { inputs: ["Loan Amount", "Interest Rate (%)", "Loan Term (years)"] } },
    cat: "financing",
    icon: "account_balance",
    tooltip: "Monthly loan payment based on rate & term.",
    calculate: (Loan, Rate, Term) => {
      const r = Rate / 100 / 12;
      const n = Term * 12;
      return (Loan * r / (1 - Math.pow(1 + r, -n))).toFixed(2);
    }
  },
  breakEven: {
    CalculatorName: "Break-even Analysis Calculator",
    pageTitle: "Break-even Analysis Calculator",
    calculatorTitle: "Break-even Analysis",
    subtitle: "Units needed to cover all expenses.",
    tabs: { "Expenses": { inputs: ["Fixed Costs", "Variable Costs per Unit"] }, "Income": { inputs: ["Revenue per Unit"] } },
    cat: "analysis",
    icon: "bar_chart",
    tooltip: "Units needed to cover all expenses.",
    calculate: (Fixed, Variable, Revenue) => (Fixed / (Revenue - Variable)).toFixed(2)
  },
   roi: {
    CalculatorName: "ROI Calculator",
    pageTitle: "Return on Investment Calculator",
    calculatorTitle: "ROI",
    subtitle: "Calculates ROI based on purchase, financing, income, and expenses.",
    tabs: {
      "Key Details": {
        inputs: [
          "Purchase Price ($)",
          "Appreciation Rate (%)",
          "Years to Hold",
          "Property Type",
          "Market (City & State)"
        ]
      },
      "Financing": {
        inputs: [
          "Down Payment (%)",
          "Cash Investment ($)",
          "Financed Amount ($)",
          "Mortgage Rate (%)",
          "Mortgage Term (Years)"
        ]
      },
      "Income": {
        inputs: ["Monthly Rent ($)"]
      },
      "Expenses": {
        inputs: [
          "Property Taxes ($/yr)",
          "Homeowner’s Insurance ($/yr)",
          "HOA ($/mo)",
          "Management Fees (%)",
          "Vacancy Rate (%)"
        ]
      }
    },
    cat: "returns",
    icon: "trending_up",
    tooltip: "ROI calculation including purchase, financing, income, and expenses.",
    calculate: function(values) {
      // Example: Simple ROI = (Net Profit / Investment) * 100
      const investment = parseFloat(values["Cash Investment ($)"] || 0);
      const netProfit = parseFloat(values["Monthly Rent ($)"] || 0) * 12 * parseFloat(values["Years to Hold"] || 1) 
                        - parseFloat(values["Property Taxes ($/yr)"] || 0)
                        - parseFloat(values["Homeowner’s Insurance ($/yr)"] || 0)
                        - parseFloat(values["HOA ($/mo)"] || 0) * 12;
      return investment ? ((netProfit / investment) * 100).toFixed(2) + "%" : "N/A";
    }
  },
  noi: {
    CalculatorName: "Net Operating Income Calculator",
    pageTitle: "Net Operating Income Calculator",
    calculatorTitle: "NOI",
    subtitle: "Income minus operating expenses.",
    tabs: { "Income": { inputs: ["Gross Income"] }, "Expenses": { inputs: ["Operating Expenses"] } },
    cat: "analysis",
    icon: "account_balance_wallet",
    tooltip: "Income minus operating expenses.",
    calculate: (GI, OE) => GI - OE
  },
  dscr: {
    CalculatorName: "Debt Service Coverage Ratio Calculator",
    pageTitle: "Debt Service Coverage Ratio Calculator",
    calculatorTitle: "DSCR",
    subtitle: "NOI ÷ debt service — lenders want 1.2+.",
    tabs: { "Income": { inputs: ["NOI"] }, "Financing": { inputs: ["Debt Service"] } },
    cat: "financing",
    icon: "shield",
    tooltip: "NOI ÷ debt service — lenders want 1.2+.",
    calculate: (NOI, Debt) => (NOI / Debt).toFixed(2)
  },
  priceToRent: {
    CalculatorName: "Price-to-Rent Ratio Calculator",
    pageTitle: "Price-to-Rent Ratio Calculator",
    calculatorTitle: "Price-to-Rent Ratio",
    subtitle: "Home price compared to rental income.",
    tabs: { "Key Details": { inputs: ["Property Price", "Annual Rent"] } },
    cat: "valuation",
    icon: "home",
    tooltip: "Home price compared to rental income.",
    calculate: (Price, Rent) => (Price / Rent).toFixed(2)
  },
  vacancy: {
    CalculatorName: "Vacancy Rate Calculator",
    pageTitle: "Vacancy Rate Calculator",
    calculatorTitle: "Vacancy Rate",
    subtitle: "Vacant units ÷ total units.",
    tabs: { "Income": { inputs: ["Vacant Units", "Total Units"] } },
    cat: "analysis",
    icon: "hotel",
    tooltip: "Vacant units ÷ total units.",
    calculate: (Vacant, Total) => ((Vacant / Total) * 100).toFixed(2) + "%"
  },
  expenseRatio: {
    CalculatorName: "Operating Expense Ratio Calculator",
    pageTitle: "Operating Expense Ratio Calculator",
    calculatorTitle: "Expense Ratio",
    subtitle: "Expenses ÷ income — lower is better.",
    tabs: { "Income": { inputs: ["Gross Income"] }, "Expenses": { inputs: ["Operating Expenses"] } },
    cat: "analysis",
    icon: "receipt_long",
    tooltip: "Expenses ÷ income — lower is better.",
    calculate: (Income, Expenses) => ((Expenses / Income) * 100).toFixed(2) + "%"
  },
  longTermROI: {
    CalculatorName: "Long-Term ROI Calculator",
    pageTitle: "Long-Term ROI Calculator",
    calculatorTitle: "Long-Term ROI",
    subtitle: "Total rent + appreciation returns.",
    tabs: { "Income": { inputs: ["Rental Income", "Property Appreciation"] }, "Key Details": { inputs: ["Investment Cost"] } },
    cat: "returns",
    icon: "timeline",
    tooltip: "Total rent + appreciation returns.",
    calculate: (Rent, App, Cost) => (((Rent + App) / Cost) * 100).toFixed(2) + "%"
  },
  flip: {
    CalculatorName: "Fix & Flip Profit Calculator",
    pageTitle: "Fix & Flip Profit Calculator",
    calculatorTitle: "Fix & Flip Profit",
    subtitle: "Sale price minus purchase & renovation costs.",
    tabs: { "Key Details": { inputs: ["Sale Price", "Purchase Price", "Renovation Costs"] } },
    cat: "returns",
    icon: "construction",
    tooltip: "Sale price minus purchase & renovation costs.",
    calculate: (Sale, Purchase, Reno) => Sale - Purchase - Reno
  },
  renovationROI: {
    CalculatorName: "Renovation ROI Calculator",
    pageTitle: "Renovation ROI Calculator",
    calculatorTitle: "Renovation ROI",
    subtitle: "Return generated from renovation expenditures.",
    tabs: { "Key Details": { inputs: ["Profit from Renovation", "Renovation Cost"] } },
    cat: "returns",
    icon: "build",
    tooltip: "Return generated from renovation expenditures.",
    calculate: (Profit, Cost) => ((Profit / Cost) * 100).toFixed(2) + "%"
  },
  taxDepreciation: {
    CalculatorName: "Tax / Depreciation Impact Calculator",
    pageTitle: "Tax / Depreciation Impact Calculator",
    calculatorTitle: "Tax / Depreciation",
    subtitle: "Taxable income minus depreciation benefits.",
    tabs: { "Income": { inputs: ["Taxable Income"] }, "Expenses": { inputs: ["Depreciation"] } },
    cat: "analysis",
    icon: "receipt",
    tooltip: "Taxable income minus depreciation benefits.",
    calculate: (Inc, Dep) => Inc - Dep
  },
  cma: {
    CalculatorName: "Comparative Market Analysis Calculator",
    pageTitle: "Comparative Market Analysis Calculator",
    calculatorTitle: "CMA",
    subtitle: "Property value vs market value.",
    tabs: { "Key Details": { inputs: ["Market Value", "Property Value"] } },
    cat: "valuation",
    icon: "analytics",
    tooltip: "Property value vs market value.",
    calculate: (M, P) => ((M / P) * 100).toFixed(2) + "%"
  },
  leverageROI: {
    CalculatorName: "Leverage ROI Calculator",
    pageTitle: "Leverage ROI Calculator",
    calculatorTitle: "Leverage ROI",
    subtitle: "Return based on leveraged equity invested.",
    tabs: { "Income": { inputs: ["Cash Flow"] }, "Key Details": { inputs: ["Equity Invested"] } },
    cat: "returns",
    icon: "trending_up",
    tooltip: "Return based on leveraged equity invested.",
    calculate: (CF, EQ) => ((CF / EQ) * 100).toFixed(2) + "%"
  }
};


    /* CATEGORY CONTAINERS */
    const categories = {
      financing: document.getElementById("cat-financing"),
      returns: document.getElementById("cat-returns"),
      valuation: document.getElementById("cat-valuation"),
      analysis: document.getElementById("cat-analysis")
    };

/* --------- RENDER TILES ----------- */
Object.entries(calculators).forEach(([key, c]) => {
  const tile = document.createElement("div");
  tile.className = "tile";
  tile.dataset.tooltip = c.tooltip;

tile.innerHTML = `
    <span class="material-icons-outlined">${c.icon}</span>
    <div>${c.calculatorTitle}</div>
`;


  tile.onclick = () => {
    loadCalculator(key);
    window.location.hash = key;
  };

  categories[c.cat].appendChild(tile);
});

/* --------- IMPORTANT: GET ALL TILE ELEMENTS ----------- */
const allTiles = document.getElementsByClassName("tile");

/* --------- GET COMMON ELEMENTS ----------- */
const titleEl = document.getElementById("calculatorTitle");
const form = document.getElementById("calculatorForm");
const resultEl = document.getElementById("result");

/* --------- LOAD CALCULATOR ----------- */

function loadCalculator(key) {
  if (!calculators[key]) return;

  const calc = calculators[key];

  // Show calculator screen, hide grid
  document.getElementById("screenGrid").style.display = "none";
  document.getElementById("screenCalculator").style.display = "block";

  // Highlight selected tile
  [...allTiles].forEach((t, i) => {
    t.classList.toggle("active", Object.keys(calculators)[i] === key);
  });

  // Set page titles
  document.getElementById("pageTitle").textContent = calc.pageTitle;
  titleEl.textContent = calc.calculatorTitle;
  document.getElementById("subtitle").textContent = calc.subtitle;

  // Reset form and result
  form.innerHTML = "";
  resultEl.textContent = "";

  // Persisted input values across tabs
  const inputValues = {};

  // Optional location input
  if (calc.location) {
    const locInput = document.createElement("input");
    locInput.type = "text";
    locInput.placeholder = "City, State";
    locInput.id = "location";
    locInput.value = inputValues["location"] || "";
    locInput.oninput = () => inputValues["location"] = locInput.value;
    form.appendChild(locInput);
  }

  // ---------- TABS ----------
  const tabContainer = document.createElement("div");
  tabContainer.className = "tab-container";
  form.appendChild(tabContainer);

  const tabContents = document.createElement("div");
  tabContents.className = "tab-contents";
  form.appendChild(tabContents);

  // Enforce tab order
  const preferredOrder = ["Key Details", "Financing", "Income", "Expenses"];
  const tabNames = preferredOrder.filter(t => calc.tabs[t]).concat(
    Object.keys(calc.tabs).filter(t => !preferredOrder.includes(t))
  );
  let activeTab = tabNames[0];

  function renderTabInputs(tab) {
    tabContents.innerHTML = ""; // clear previous inputs
    activeTab = tab;

    calc.tabs[tab].inputs.forEach((name) => {
      const inputGroup = document.createElement("div");
      inputGroup.className = "input-group";

      const label = document.createElement("label");
      label.textContent = name;
      label.htmlFor = name;

      const input = document.createElement("input");
      input.type = "number";
      input.placeholder = name;
      input.id = name;

      // Restore previously entered value if exists
      if (inputValues[name] !== undefined) input.value = inputValues[name];

      // Save input value on change
      input.oninput = () => inputValues[name] = input.value;

      inputGroup.appendChild(label);
      inputGroup.appendChild(input);
      tabContents.appendChild(inputGroup);
    });
  }

  // Create tab buttons
  tabNames.forEach((tab) => {
    const tabBtn = document.createElement("div");
    tabBtn.className = "tab";
    tabBtn.textContent = tab;
    if (tab === activeTab) tabBtn.classList.add("active");

    tabBtn.onclick = () => {
      [...tabContainer.children].forEach(t => t.classList.remove("active"));
      tabBtn.classList.add("active");
      renderTabInputs(tab);
    };

    tabContainer.appendChild(tabBtn);
  });

  // Render initial tab inputs
  renderTabInputs(activeTab);

  // ---------- CALCULATE BUTTON ----------
  const button = document.createElement("button");
  button.textContent = "Calculate";
  button.className = "calc-btn";

  button.onclick = (e) => {
    e.preventDefault();

    const values = calc.tabs[activeTab].inputs.map(id => {
      const val = inputValues[id];
      return val !== undefined ? Number(val) : NaN;
    });

    const locationValue = calc.location ? inputValues["location"] : null;

    if (values.some(v => isNaN(v))) {
      resultEl.textContent = "Please fill in all required inputs!";
      return;
    }

    try {
      resultEl.textContent = `Result: ${calc.calculate(...values, locationValue)}`;
    } catch (err) {
      resultEl.textContent = "Error in calculation. Check your inputs.";
      console.error(err);
    }
  };

  form.appendChild(button);
}


  /* --------- BACK BUTTON ----------- */
document.getElementById("backBtn").onclick = () => {
  document.getElementById("screenCalculator").style.display = "none";
  document.getElementById("screenGrid").style.display = "block";
  resultEl.textContent = "";
  window.location.hash = "";
};

  function tryLoadFromHash() {
  const hash = window.location.hash.replace("#", "");
  if (hash && calculators[hash]) {
    loadCalculator(hash);
  }
}

// On initial load
window.addEventListener("load", tryLoadFromHash);

// Also respond if the hash changes later
window.addEventListener("hashchange", () => {
  tryLoadFromHash();
});


  </script>

</body>
</html>
